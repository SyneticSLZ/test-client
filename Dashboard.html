<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Voltmailer</title>
    <link rel="stylesheet" href="style.css">
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> -->
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.3.0/uicons-bold-straight/css/uicons-bold-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.3.0/uicons-solid-straight/css/uicons-solid-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.3.0/uicons-bold-straight/css/uicons-bold-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.3.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.3.0/uicons-bold-rounded/css/uicons-bold-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.3.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.0/uicons-regular-straight/css/uicons-regular-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.3.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.2/uicons-regular-straight/css/uicons-regular-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.2/uicons-regular-straight/css/uicons-regular-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.2/uicons-bold-rounded/css/uicons-bold-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.5.1/uicons-thin-straight/css/uicons-thin-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.5.1/uicons-thin-straight/css/uicons-thin-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.5.1/uicons-thin-rounded/css/uicons-thin-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.5.1/uicons-thin-rounded/css/uicons-thin-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.5.1/uicons-thin-rounded/css/uicons-thin-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.5.1/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>   
    <script src="https://cdn.jsdelivr.net/npm/progressbar.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> 
<script>
    
let submittedData = [];
let generatedData = [];
let U_Username;
let U_MyEmail;


window.onload = function() {
            if (window.innerWidth <= 768) {
                window.location.href = "https://voltmailer.com/mobile.html";
            }
        };


async function init() {
    console.log("running")
    const urlParams = new URLSearchParams(window.location.search);
    var token  = urlParams.get('token');        
    var affiliate = urlParams.get('affiliate');  
    var connectedGoogle = urlParams.get('connectedgoogletoken');
    
    if (affiliate){
        localStorage.setItem('affiliate', affiliate);
    }

    if(connectedGoogle) {
        connectedgoogleAuth();
    }else {
            if (token) {
                console.log("noraml running")
                fetchUserData();
            } else {
                console.log("google running")
                googleAuth();
            }

        }
}
// Call fetchUserData on page load
document.addEventListener("DOMContentLoaded", function() {
    init()
    if (localStorage.getItem('connectedGoogle') ==='Rally') {
        const urlParams = new URLSearchParams(window.location.search);
        var googele  = urlParams.get('googletoken');
        window.location.href = `https://voltmailer.com/Rally-Beacon-Dashboard.html?googletoken=${googele}`
    }


    // window.tasks = [
    //     { id: 1, completed: false },
    //     { id: 2, completed: false },
    //     { id: 3, completed: false },
    // ];
    // const totalTasks = tasks.length;
    // initializeProgressBar();
    // updateProgress(tasks, totalTasks);

    // tasks.forEach(task => {
    //     const taskElement = document.querySelector(`.task[data-task-id="${task.id}"] i`);
    //     if (taskElement) {
    //         taskElement.addEventListener('click', () => toggleDetails(taskElement));
    //     }
    // });

});

// let progressBar;

// function initializeProgressBar() {
//     progressBar = new ProgressBar.Circle('#progress-circle', {
//         color: '#aaa',
//         strokeWidth: 8,
//         trailWidth: 8,
//         trailColor: '#eee',
//         easing: 'easeInOut',
//         duration: 1400,
//         text: {
//             autoStyleContainer: false
//         },
//         from: { color: '#ff0000', width: 8 },
//         to: { color: '#00ff00', width: 8 },
//         step: function(state, circle) {
//             circle.path.setAttribute('stroke', state.color);
//             circle.path.setAttribute('stroke-width', state.width);

//             const value = Math.round(circle.value() * 100);
//             if (value === 0) {
//                 circle.setText('');
//             } else {
//                 circle.setText(`${value}%`);
//             }
//         }
//     });

//     progressBar.text.style.fontFamily = '"Raleway", Helvetica, sans-serif';
//     progressBar.text.style.fontSize = '2rem';
// }

// function updateProgress(tasks, totalTasks) {
//     console.log(totalTasks)
//     const completedTasks = tasks.filter(task => task.completed).length;
//     const percentage = (completedTasks / totalTasks) * 100;
// if (percentage != 0) {
//     document.getElementById('progress-percentage').innerHTML = ``;
// }

//     progressBar.animate(percentage / 100); // Number from 0.0 to 1.0

//     tasks.forEach(task => {
//         const icon = document.getElementById(`task-icon-${task.id}`);
//         if (icon) {
//             if (task.completed) {
//                 icon.className = 'fi fi-br-check'; // Update the icon class for completed task
//             } else {
//                 icon.className = 'fi fi-rr-angle-small-down'; // Update the icon class for incomplete task
//             }
//         }
//     });
// }

function toggleDetailsx(icon) {
    const taskElement = icon.parentElement;
    const taskId = taskElement.getAttribute('data-task-id');
    const detailsElement = document.querySelector(`.task-details[data-task-id="${taskId}"]`);
    
    if (detailsElement) {
        if (detailsElement.style.display === 'none' || detailsElement.style.display === '') {
            detailsElement.style.display = 'block';
            // icon.className = 'fi fi-ss-hexagon'; // Update the icon class for details open
        } else {
            detailsElement.style.display = 'none';
            // icon.className = 'fi fi-ss-hexagon'; // Update the icon class for details closed
        }
    }
}

function completeTask(taskId) {
    const task = tasks.find(t => t.id == taskId);
    task.completed = !task.completed;
    const totalTasks = tasks.length;
    updateProgress(tasks, totalTasks);
}

function sendFirstEmail() {
    // Logic to send the first email
    completeTask(1);
}

function createFirstCampaign() {
    // Logic to create the first campaign
    createCampaign()
    completeTask(2);
}

function editUsername() {
    // Logic to edit the username
    completeTask(3);
}





function getEmailTokenFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('token');
}

function decodeEmailJWT(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    return JSON.parse(atob(base64));
}

// function fetchUserData() {
//     const token = getEmailTokenFromUrl();
//     if (token) {
//         const decoded = decodeEmailJWT(token);
//         const email = decoded.email;
//         U_MyEmail = decoded.email;

//         fetch('https://server.voltmailer.com/user-data', {
//             method: 'GET',
//             headers: {
//                 'Authorization': `Bearer ${token}`,
//                 'Content-Type': 'application/json'
//             }
//         })
//         .then(response => response.json())
//         .then(data => {
//             if (data.error) {
//                 console.error('Error fetching user data:', data.error);
//                 window.location.href='https://voltmailer.com/ExpiredSession.html'
//             } else {
//                 // Customize the page using user data
//                 // document.getElementById('userEmail').textContent = data.email;
//                 console.log(data)

//                 const UserEmail = data.email
//                 U_MyEmail = data.email
//                 const UserStripeID = data.email
//                 RenderHtml(data);
//                 // Add more customization based on user data
//             }
//         })
//         .catch(error => {
//             console.error('An error occurred:', error);
//         });
//     } else {
//         console.error('Token not found in URL');
//     }
// }

function fetchUserData() {
    console.log("fetching data")
    const token = getEmailTokenFromUrl();
    if (token) {
        const decoded = decodeEmailJWT(token);
        const email = decoded.email;
        U_MyEmail = decoded.email;

        fetch('https://server.voltmailer.com/user-data', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            console.log("response : ", response)
            if (response.status === 401) {
                // Unauthorized error, redirect to expired session page
                window.location.href = 'https://voltmailer.com/ExpiredSession.html';
                return null; // Stop further processing
            }
            return response.json();
        })
        .then(data => {
            if (data && data.error) {
                console.error('Error fetching user data:', data.error);
                window.location.href = 'https://voltmailer.com/ExpiredSession.html';
            } else if (data) {
                // Customize the page using user data
                console.log(data);
                const UserEmail = data.email;
                U_MyEmail = data.email;
                const UserStripeID = data.email;
                RenderHtml(data);
                // Add more customization based on user data
            }
        })
        .catch(error => {
            console.error('An error occurred:', error);
        });
    } else {
        console.error('Token not found in URL');
    }
}


function logout(){
    localStorage.clear();
    window.location.href='https://voltmailer.com/'
}
function ConnectGoogle() {
    localStorage.setItem('connectedGoogle', 'False');
    window.location.href = 'https://server.voltmailer.com/auth/google';
}


function parseJWT(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    
    return JSON.parse(jsonPayload);
}

async function GetMetrics(email) {
    try{
        const response = await fetch('https://server.voltmailer.com/api/metrics/${email}');
        const data = await response.json();
        console.log("recieved data : ", data.bounceRate, " and ", data.replyRate)

        if (response.ok){
            document.getElementById('cs').innerHTML = `${data.numberOfCampaigns}`;
            // document.getElementById('metric-label-br').innerHTML = `${data.bounceRate}`;
            // document.getElementById('metric-label-rr').innerHTML = `${data.replyRate}`;
        } else {
            console.error('ERROR', data.message)
        }
    } catch (error) {
        console.error('Error Fetching Metrics', error)
    }
}

async function RenderHtml(data){
    
    document.getElementById('sending').style.display = 'none';
    const planEmails = data.plan_emails
    
    
    const name = data.name
    U_Username = name
    const email = U_MyEmail
    // GetMetrics(email)
    const UserEmail = data.email

    const plan = data.plan
    const CapsPlan = plan.charAt(0).toUpperCase() + plan.slice(1);
    const UsedEmails = data.total_emails
    const stripeID = data.stripeID
    const token = localStorage.getItem('authToken');
    // const userData = parseJWT(token);
    //     console.log('User Data:', userData);
    //     document.getElementById('maintop').innerHTML=`
    //                 <div class="plan">${CapsPlan} plan Subscriber</div>
    //         <div class="google" id="googleauthid">
    //                 Emails Sent From : ${userData.email}
    //         </div>
    //     `;

    let button = document.getElementById('submit')
    let percentageUsed = (UsedEmails / planEmails) * 100;

    percentageUsed = Math.min(100, percentageUsed); // Ensure it doesn't go over 100%
    
    document.getElementById('h2name').innerHTML=`${name}`;
    // document.getElementById('metric-label-plan').innerHTML = `${plan}`;
    // document.getElementById('metric-label-total').innerHTML = `${UsedEmails}`;
    document.getElementById('plan-usage-detail').innerHTML = `${UsedEmails} of ${planEmails} emails used this month`;
    // document.getElementById('metric-label-br').innerHTML = `${data.bounceRate}`;
    // document.getElementById('metric-label-rr').innerHTML = `${data.totalReplies}`;
    document.getElementById('cs').innerHTML = `${data.campaigns.length}`;
    // document.getElementById('rr').innerHTML = `${data.totalReplies}`;
    // document.getElementById('br').innerHTML = `${data.bounceRate}%`;
    document.getElementById('ed').innerHTML = `${UsedEmails}`;


    // document.getElementById('plan-usage-detail').innerHTML=`You have used : ${UsedEmails} Emails of :  ${planEmails} Emails / mo`;
    document.getElementById('progress-text').innerHTML=`<p>Current: ${UsedEmails}</p><p>Total: ${planEmails}</p>`;
    document.getElementById('subscription').onclick = function() { billing(data.stripeID, data.email) };
    document.getElementById('3').onclick = function() { billing(data.stripeID, data.email) };
    document.getElementById('billing-man').onclick = function() { billing(data.stripeID, data.email) };
    document.getElementById('progressx').style.width = percentageUsed + '%'; 

    if (plan === "free" || plan === "pro"){
        document.getElementById('DOMAIN').style.display = "none"
    }
    document.getElementById('myAccount-content').innerHTML = `
    
    <div class="dashboard-usage">
            <h1>Your Account</h1>
            <h4>A detailed overview of your metrics, usage, plan and more</h4>
            <h2>Name</h2>
            <h4>This is the name your emails are sent from.</h4>
            <div class="coolinput">
                <!-- <label for="input" class="text">Name:</label> -->
                <input type="text" placeholder="${name}" name="input" class="input" id="name" value="${name}">
            </div>
            <h5 id="errorMessagename"></h5>
            <button class="button-man" onclick="updateNameForm()">Save</button>

            <h2>Email</h2>
            <h4>The Email associated with your account, not necessarily the email used to send your emails.</h4>
            <div class="coolinput">
                <!-- <label for="input" class="text">Email:</label> -->
                <input type="text" placeholder="${UserEmail}" name="input" class="input" id="emailinput" value="${UserEmail}">
                <!-- <input placeholder="Email address" class="input" name="text" type="email" placeholder="CoolGuy1@email.com"/> -->
            </div>     
            <h5 id="errorMessageemail"></h5>         
            <button class="button-man"  onclick="updateEmailForm())" >Save</button>


            <h2 class="password-reset">Reset Password</h2>

            <div class="coolinput">
                <input type="text" placeholder="New Password" name="input" class="input" id="newPassword" >
            </div>

            <div class="coolinput">
                <!-- <label for="input" class="text">Website:</label> -->
                <input type="text" placeholder="Confirm Password" name="input" class="input" id="confirmPassword" >
            </div>
            <h5 id="errorMessage"></h5>
            <button class="button-man" onclick="updatePasswordForm()">Save</button>
          </div>
    ` 
    // document.getElementById('sidemenu').innerHTML=`
    //         <div class="menu-item active" id="1"><i class="fi fi-br-house-blank"></i>Home</div>
    //         <div class="menu-item" id="2"> <i class="fi fi-bs-pulse"></i>Usage</div>
    //         <div class="menu-item" id="3" onclick="billing(data.stripeID)" > <i class="fi fi-rr-credit-card"></i> Billing</div>
    //         <div class="menu-item tools">Tools</div>
    //         <div class="menu-item" id="openPopup"><i class="fi fi-rr-user-pen"></i>Account</div>
    //         <div class="menu-item end" id="5"><i class="fi fi-rr-customer-service"></i>Help</div>
    // `;


        if (UsedEmails >= planEmails) {
                button.innerHTML=`                    
                <button class="button" onClick="billing(${stripeID}, ${email})" >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                        Unlock Pro
                </button>`
            }
        else {
            if (!token){
                document.getElementById('maintop').innerHTML=`
                    <div class="plan">${CapsPlan} plan Subscriber</div>
            <div class="google" id="googleauthid">
<div onclick="ConnectGoogle()" style="cursor: pointer; text-decoration: underline;"> Please connect your gmail Account</div> 
            </div>
        `;
        button.innerHTML=`
                    
                    <button class="button" onclick="ConnectGoogle()">
                        <img  src='google.png' alt="google" style="height= 30px; width: 30px;">
                        Connect Google
                      </button>



                      
                      `

            } else {
            button.innerHTML=`
                    
                    <button class="button" onclick="Submitandcheckautosend()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                        Generate
                      </button>

                      `

        }
    }



    // showNotification(`Welcome, ${name}`)
}

async function googleAuth() {
    const urlParams = new URLSearchParams(window.location.search);
    const googleToken = urlParams.get('googletoken');
    if (googleToken) {
        const userData = parseJWT(googleToken);
        console.log('User Data:', userData);
        U_MyEmail = userData.email;
        // document.getElementById('user-email').textContent = `GOOGLE ACCOUNT SIGNED IN: ${userData.email}`;
        
        // Store the token in localStorage or use it directly for sending emails
        localStorage.setItem('authToken', googleToken);


        
        fetch('https://server.voltmailer.com/google-user-data', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${googleToken}`,
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                window.location.replace("https://voltmailer.com");
                console.error('Error fetching user data:', data.error);
                
            } else {
                // Customize the page using user data
                // document.getElementById('userEmail').textContent = data.email;
                console.log(data)

                const UserEmail = data.email
                const UserStripeID = data.email
                        document.getElementById('googleauthid').innerHTML=`

                    Emails Sent From : ${UserEmail}

        `;
                RenderHtml(data);

                // Add more customization based on user data
            }
        })
        .catch(error => {
            console.error('An error occurred:', error);
        });


        
    }
}


async function connectedgoogleAuth() {
    let button = document.getElementById('submit')
    const urlParams = new URLSearchParams(window.location.search);
    const connectedGoogletoken = urlParams.get('connectedgoogletoken');
    if (connectedGoogletoken) {
        const userData = parseJWT(connectedGoogletoken);
        console.log('User Data:', userData);
        U_MyEmail = userData.email;
        localStorage.setItem('authToken', connectedGoogletoken);
        document.getElementById('googleauthid').innerHTML=`
                    Emails Sent From : ${userData.email}
        `;

        button.innerHTML=`
                    
                    <button class="button" onclick="Submitandcheckautosend()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                        Generate
                      </button>`;
    }
}



// document.getElementById('openPopup').addEventListener('click', () => {
//             document.getElementById('popup').classList.remove('hidden');
//         });

        // document.getElementById('closePopup').addEventListener('click', () => {
        //     document.getElementById('popup').classList.add('hidden');
        // });

        // document.getElementById('profileTab').addEventListener('click', () => {
        //     showContent('profileContent');
        // });

        // document.getElementById('workspacesTab').addEventListener('click', () => {
        //     showContent('workspacesContent');
        // });

        // document.getElementById('sessionsTab').addEventListener('click', () => {
        //     showContent('sessionsContent');
        // });

        // function showContent(contentId) {
        //     const contents = document.querySelectorAll('.content');
        //     contents.forEach(content => {
        //         content.classList.remove('active');
        //     });
        //     document.getElementById(contentId).classList.add('active');

        //     const tabs = document.querySelectorAll('.sidebar-item');
        //     tabs.forEach(tab => {
        //         tab.classList.remove('active');
        //     });
        //     document.querySelector(`#${contentId}Tab`).classList.add('active');
        // }



// CSV LOGIC

function ShowCsv(){
    const csvBTN = document.getElementById('csvBTN');
    const input = document.getElementById('csvFile');

    csvBTN.style.display = 'none';
    input.style.display = 'block';
    console.log("switched")
}


function detectColumnType(sample) {
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const namePattern = /^[A-Za-z ,.'-]+$/;
    const websitePattern = /^(https?:\/\/)?([\w-]+)\.([a-z]{2,6})(\.[a-z]{2,6})?(\/[\w\-.]*)*\/?$/;

    if (emailPattern.test(sample)) return 'email';
    if (namePattern.test(sample)) return 'name';
    if (websitePattern.test(sample)) return 'website';

    return null;
}

        function handleFileSelect(input) {
            let center = document.getElementById('center');
            center.style.display = 'none'
            const file = input.files[0];
            processCSV(file);
        }

        function processCSV(file, hasHeaders) {
    if (!file) {
        alert('Please upload a CSV file.');
        return;
    }

    Papa.parse(file, {
        header: hasHeaders,
        dynamicTyping: true,
        complete: function(results) {
            const data = results.data;
            if (data.length === 0) {
                console.log('Empty CSV file.');
                return;
            }

            let columns;
            if (hasHeaders) {
                columns = Object.keys(data[0]);
            } else {
                // Generate default column names
                columns = data[0].map((_, index) => `Column${index + 1}`);
                data.forEach((row, rowIndex) => {
                    data[rowIndex] = row.reduce((acc, value, index) => {
                        acc[columns[index]] = value;
                        return acc;
                    }, {});
                });
            }

            let emailCol, nameCol, websiteCol;

            for (let col of columns) {
                const sampleValue = data[0][col];
                const colType = detectColumnType(sampleValue);

                if (colType === 'email') emailCol = col;
                if (colType === 'name') nameCol = col;
                if (colType === 'website') websiteCol = col;
            }

            if (!emailCol || !nameCol || !websiteCol) {
                console.log('Could not detect all necessary columns.');
                return;
            }

            data.forEach(row => {
                const formData = {
                    email: row[emailCol],
                    website: row[websiteCol],
                    name: row[nameCol]
                };
                submittedData.push(formData);
                updateTable();
            });

            console.log(JSON.stringify(submittedData, null, 2));
        }
    });
}




function handleFile(event) {
    console.log("running file chanfge")
    const file = event.target.files[0];
    if (file) {
        const fileExtension = file.name.split('.').pop().toLowerCase();
        if (fileExtension === 'xlsx') {
            handleExcelFile(file);
        } else if (fileExtension === 'csv') {
            handleCSVFile(file);
        } else {
            alert('Unsupported file type');
        }
    }
}

function handleExcelFile(file) {
    const reader = new FileReader();
    reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet);

        processData(jsonData);
    };
    reader.readAsArrayBuffer(file);
}

function handleCSVFile(file) {
    Papa.parse(file, {
        header: true,
        complete: function(results) {
            processData(results.data);
        }
    });
}

function processData(data) {
    const emailCol = 'Email';
    const websiteCol = 'Website';
    const nameCol = 'Name';
                let center = document.getElementById('center');
            center.style.display = 'none'
    // const submittedData = [];

    data.forEach(row => {
        const formData = {
            email: row[emailCol],
            website: row[websiteCol],
            name: row[nameCol]
        };
        submittedData.push(formData);
        updateTable();
    });

    console.log(submittedData); // Display the output in the console
}



function togglePopupManual() {
      const overlay = document.getElementById('manual-popup-overlay');
      const emailInput = document.getElementById('email');
        const websiteInput = document.getElementById('website');
        const nameInput = document.getElementById('name');



        // emailInput.value = "";
        // websiteInput.value = "https://";
        // nameInput.value = "";
      overlay.style.display = overlay.style.display === 'flex' ? 'none' : 'flex';

    }
    function togglePopupDomain() {
      const overlay = document.getElementById('manual-popup-overlay-domain');
    //   const emailInput = document.getElementById('email');
        // const websiteInput = document.getElementById('website');
        // const nameInput = document.getElementById('name');



        // emailInput.value = "";
        // websiteInput.value = "https://";
        // nameInput.value = "";
      overlay.style.display = overlay.style.display === 'flex' ? 'none' : 'flex';

    }

    function isValidURL(string) {
  try {
    new URL(string);
    return false;
  } catch (_) {
    return true;  
  }
}

async function aaddEmailToCampaign(customerEmail, campaignId, newEmailDetails) {
    try {
        const response = await fetch('https://server.voltmailer.com/api/campaigns/addEmail', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: customerEmail,
                campaignId: campaignId,
                newEmail: newEmailDetails
            }),
        });

        const result = await response.json();

        if (response.ok) {
            console.log("Email added successfully:", result);
            alert("Email added to campaign successfully!");
        } else {
            console.error("Failed to add email:", result.message);
            alert(`Error: ${result.message}`);
        }
    } catch (error) {
        console.error("Error adding email to campaign:", error);
        alert("An error occurred while adding the email.");
    }
}







async function Manual() {
        const emailInput = document.getElementById('emailinput');
        const websiteInput = document.getElementById('website');
        const nameInput = document.getElementById('name');
        const email_inputted = emailInput.value;
        let website = websiteInput.value;
        const name = nameInput.value;

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const websiteRegex = /^https:\/\/.+$/;

    // // Prepend "https://" if not included
    if (!/^https:\/\//i.test(website)) {
        website = 'https://' + website;
    }
    console.log(isValidURL(website))
        if (!emailRegex.test(email_inputted)) {
            manualError.textContent = "Invalid email format.";
            return;
        } else if (!websiteRegex.test(website)) {
            manualError.textContent = "Invalid website format. Must start with https://";
            return;
        } else {
            manualError.textContent = "";
        }

        if (isValidURL(website)){
            manualError.textContent = "Invalid URL format.";
            return;
            } else {
                manualError.textContent = "";
            }

        const formData = {
            email: email_inputted,
            website: website,
            name: name
        };

        submittedData.push(formData);
        console.log(updateTable());
         // Clear input fields manually
        emailInput.value = "";
        websiteInput.value = "https://";
        nameInput.value = "";
        console.log("cleared")

// Usage example:
// const campaignId = localStorage.getItem('currentCampaignId'); // Assuming this is set
// const testEmailDetails = {
//     recipientEmail: 'test@example.com',
//     subject: 'Hello World',
//     messageId: 'msg123',
//     threadId: 'thread456',
//     status: 'sent',
//     bounces: false,
//     responseCount: 0
// };

// aaaaddEmailToCampaign(campaignId, testEmailDetails);

// Example usage:
// const customerEmail = "rohanmehmi72@gmail.com";
// const newEmailDetails = {
//     recipientEmail: "recipient@example.com",
//     subject: "Your subject here",
//     messageId: "unique-message-id",
//     threadId: "unique-thread-id",
//     sentTime: new Date(),
//     status: "sent",
//     bounces: false,
//     responseCount: 0
// };

// aaddEmailToCampaign(customerEmail, campaignId, newEmailDetails);



        togglePopupManual()
}

// function updateTable() {
//       const dataTable = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
//       let center = document.getElementById('center');
//       center.style.display = 'none';
//       dataTable.innerHTML = ''; // Clear the existing table rows
//       console.log("working: ", submittedData);
      
//       submittedData.forEach((data, index) => {
//         const row = dataTable.insertRow();
//         const emailCell = row.insertCell(0);
//         const websiteCell = row.insertCell(1);
//         const nameCell = row.insertCell(2);
//         const actionCell = row.insertCell(3); // Cell for delete button

//         // Create delete button
//         const deleteButton = document.createElement('button');
//         deleteButton.style.color = "#000";
//         deleteButton.textContent = 'X';

//         deleteButton.addEventListener('click', function() {
//           deleteRow(index); // Call deleteRow function with index
//         });

//         emailCell.textContent = data.email;
//         websiteCell.textContent = data.website;
//         nameCell.textContent = data.name;
//         actionCell.appendChild(deleteButton); // Append delete button to action cell
//         row.setAttribute('data-index', index);
//       });
//     }

//     function deleteRow(index) {
//       submittedData.splice(index, 1); // Remove data from array
//       updateTable(); // Update table to reflect changes
//     }

    function updateTable() {
    const dataTable = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
    let center = document.getElementById('center');
    const thead = document.getElementById('dataTable').getElementsByTagName('thead')[0];
    // document.getElementById("thead").style.display = "inline-block";
    center.style.display = 'none';
    dataTable.innerHTML = ''; // Clear the existing table rows


    if (!thead || thead.rows.length === 0) {
        if (!thead) {
            thead = table.createTHead();
        }
        const headerRow = thead.insertRow();
        const headers = ['Email', 'Website', 'Recipient Name', 'Actions'];

        headers.forEach(headerText => {
            const th = document.createElement('th');
            th.textContent = headerText;
            headerRow.appendChild(th);
        });
    }


    console.log("working: ", submittedData);

    submittedData.forEach((data, index) => {
        const row = dataTable.insertRow();
        const emailCell = row.insertCell(0);
        const websiteCell = row.insertCell(1);
        const nameCell = row.insertCell(2);
        const actionCell = row.insertCell(3); // Cell for action buttons

        // Create edit button
        const editButton = document.createElement('button');
        editButton.style.color = "#000";
        editButton.textContent = 'Edit';

        editButton.addEventListener('click', function() {
            editRow(index, row); // Call editRow function with index
        });

        // Create delete button
        const deleteButton = document.createElement('button');
        deleteButton.style.color = "#000";
        deleteButton.textContent = 'X';

        deleteButton.addEventListener('click', function() {
            deleteRow(index); // Call deleteRow function with index
        });

        emailCell.textContent = data.email;
        websiteCell.textContent = data.website;
        nameCell.textContent = data.name;
        actionCell.appendChild(editButton); // Append edit button to action cell
        actionCell.appendChild(deleteButton); // Append delete button to action cell
        row.setAttribute('data-index', index);
    });
}

function deleteRow(index) {
    submittedData.splice(index, 1); // Remove data from array
    updateTable(); // Update table to reflect changes
}


function editRow(index, row) {
    const data = submittedData[index];
    const emailCell = row.cells[0];
    const websiteCell = row.cells[1];
    const nameCell = row.cells[2];
    const actionCell = row.cells[3];

    // Replace text with input fields
    emailCell.innerHTML = `<input type="email" value="${data.email}" />`;
    websiteCell.innerHTML = `<input type="url" value="${data.website}" />`;
    nameCell.innerHTML = `<input type="text" value="${data.name}" />`;

    // Change the edit button to a save button
    const saveButton = document.createElement('button');
    saveButton.style.color = "#000";
    saveButton.textContent = 'Save';
    saveButton.addEventListener('click', function() {
        saveRow(index, row); // Call saveRow function with index and row
    });

    // Remove old edit and delete buttons

    actionCell.appendChild(saveButton);
}

function saveRow(index, row) {
    const emailCell = row.cells[0];
    const websiteCell = row.cells[1];
    const nameCell = row.cells[2];
    const actionCell = row.cells[3];

    // Get new values from input fields
    const newEmail = emailCell.firstChild.value;
    const newWebsite = websiteCell.firstChild.value;
    const newName = nameCell.firstChild.value;

    // Update the submittedData array
    submittedData[index] = { email: newEmail, website: newWebsite, name: newName };

    // Replace input fields with text
    emailCell.textContent = newEmail;
    websiteCell.textContent = newWebsite;
    nameCell.textContent = newName;

    // Restore the edit and delete buttons
    actionCell.innerHTML = '';

    // Create edit button
    const editButton = document.createElement('button');
    editButton.style.color = "#000";
    editButton.textContent = 'Edit';
    editButton.addEventListener('click', function() {
        editRow(index, row); // Call editRow function with index and row
    });

    // Create delete button
    const deleteButton = document.createElement('button');
    deleteButton.style.color = "#000";
    deleteButton.textContent = 'X';
    deleteButton.addEventListener('click', function() {
        deleteRow(index); // Call deleteRow function with index
    });

    actionCell.appendChild(editButton); // Append edit button to action cell
    actionCell.appendChild(deleteButton); // Append delete button to action cell
}





    function clearTable() {
      submittedData = []; // Clear the data array
      updateTable(); // Update table to reflect changes
    }

    function reset(){
        console.log("reset clicked")
        // formData = []
        submittedData = [];
        // if (submittedData = []){
            // return;
        // }else{
            // submittedData = [];
            
        // }
        updateTable();
        // dataTable.innerHTML = '';
// document.getElementById('tablerows').innerHTML = '';
    }

// SUBMIT THE DATA 

function checkbox() {
            const checkbox = document.getElementById('cbx-46');
            const text = document.getElementById('autosend-text');
            if (checkbox.checked) {
                text.innerHTML = 'Autosend is <b>ON</b>';
            } else {
                text.innerHTML = 'Autosend is <b>OFF</b>';
            }
        }

function IsAutoSend() {
            const checkbox = document.getElementById('cbx-46');
            return checkbox.checked;
        }

function Submitandcheckautosend(){
          if (submittedData.length === 0) {
              // The array is empty
              console.log('The array is empty');
              showNotification(`Please submit data`);
          } 
          else {
            // The array is not empty
            console.log('The array is not empty');
            const userPitch = document.getElementById('userPitch').value;
            const UserSubject = document.getElementById('UserSubject').value;
            const userTemplate = document.getElementById('userTemplate').value;
            if (userPitch.trim() === '') {
                // The value is empty or only contains whitespace
                console.log('No value provided');
                showNotification(`Please submit a pitch`);
            } else {
                // The value is not empty
                console.log('Value provided:', userPitch);
                if (IsAutoSend()){
                  Autosend_new();
                }else{
                  manualSend();
            }
            }
          }
        }
// SENDING THE EMAILS AUTOMATED (TAB CAN BE CLOSED)
// async function Autosend() {
//   const dataTable = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
//   // get the pitch and create a thread
//   const userPitch = document.getElementById('userPitch').value; // Get user pitch from textarea
//   const button = document.getElementById('submit');
//   button.innerHTML=`<button class="btn"><div class="loader"></div> </button>`
//   const threadResponse = await fetch('/create-thread', { method: 'POST' });

//   const threadData = await threadResponse.json();
//   const threadID = threadData.thread_id;
//   console.log(threadID)
//   SENT_EMAILS = 0
//   // iterate through each item in the submitted data and send to its respective email address 
//   for (let index = 0; index < submittedData.length; index++) {
//         const data = submittedData[index];
//         console.log('starting send to ', data.email);

//         try {
//           updateRowStatus(index, 'Retrieving message');
//             // Get the website content
//             const descriptionResponse = await fetch('/get-site-description', {
//                 method: 'POST',
//                 headers: { 'Content-Type': 'application/json' },
//                 body: JSON.stringify({ url: data.website })
//             });

//             const descriptionData = await descriptionResponse.json();
//             const website_content = descriptionData.description;
//             const Uname = '{{ name }}'
//             const To = data.name
//             console.log(data.email, website_content,Uname, To );

//             updateRowStatus(index, 'Personalizing message');
//             // Add messages to the thread
//             const emailContentResponse = await fetch('/add-messages-to-thread', {
//                 method: 'POST',
//                 headers: {
//                     'Content-Type': 'application/json'
//                 },
//                 body: JSON.stringify({
//                     thread_id: threadID,
//                     website_content: website_content,
//                     user_pitch: userPitch,
//                     To: To,
//                     Me: Uname
//                 })
//             });

//             const emailContentData = await emailContentResponse.json();
//             const email_content = emailContentData.email_content;
//             const lines = email_content.split('\n');
//             const subject_line = lines[0].replace('Subject: ', '');
//             const main_message = lines.slice(1).join('\n').trim();
//             console.log(data.email, "returned email sub : ", subject_line);
//             console.log(data.email, " email content : ", main_message);

//             updateRowStatus(index, 'Sending');
//             // Send the emails
//             const result = await sendMessage('me', data.email, subject_line, main_message);
//             console.log('Message to ', data.email, ' successfully sent:', result);
//             showNotification(`Message to ${data.email} successfully sent`)
//             updateRowStatus(index, 'Sent');
//             SENT_EMAILS = SENT_EMAILS + 1;
//         } catch (error) {
//             console.error('Error processing email for', data.email, ':', error);
//             showNotification(`Error processing email for ${data.email}`)
//             updateRowStatus(index, 'Error');
//             // add to error row data, give user option to attempt to resend all error data at the end.
//             // Optionally handle resend logic here
//         }
//     }
//   console.log('all emails sent');
//   showNotification('All Emails Sent !')
//   button.innerHTML=`<button class="button" onclick="Restart()">
//                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
//                           <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
//                         </svg>
//                        Send More
//                       </button>
//                       <h3>Sent!</h3>`
//   useEmails(SENT_EMAILS);


// }


async function Autosend() {
  const button = document.getElementById('submit');
  button.innerHTML = `<button class="btn"><div class="loader"></div> </button>`;

  const userPitch = document.getElementById('userPitch').value; 
//   const submittedData = getSubmittedData(); // Replace with your method of retrieving the submitted data

  const response = await fetch('/start-email-task', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ submittedData, userPitch })
  });

  const responseData = await response.json();
  const taskId = responseData.task_id;

  checkTaskStatus(taskId);
}

function NewCampaign() {
    submittedData = [];
    generatedData = [];
                    // reset the whole thing {

                    // disable button 
                    document.getElementById('pr').style.display = `block`;
                    document.getElementById('sending').style.display = 'none';

                    document.getElementById('uploadLabel').style.display = "flex";
                    document.getElementById('DOMAIN').style.display = "flex";
    document.getElementById('man').style.display = "flex";
    document.getElementById('export').style.display = "none";
                    // disable textarea 
                    // disable buttons 
                    // const dataTable = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
                    // dataTable.style.display = "none"
                    let center = document.getElementById('center');
                    center.style.display = 'flex'

                    document.getElementById('currentContent').style.display = 'flex';
                    document.getElementById('newContent').style.display = 'none';
                    // document.getElementById('hidewhengenerating').style.display = 'flex';

                    formData = []
                    submittedData = []

                    document.getElementById('submit').innerHTML = `<button class="button" onclick="Submitandcheckautosend()" id="submit">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                        Generate
                    </button> `
                    updateTable();
                    const csv = document.getElementById('uploadLabel');
                    const man = document.getElementById('man');
                    csv.disabled = false;
                    man.disabled = false;
                    const textarea = document.getElementById('userPitch');
                    textarea.disabled = false;
                    // document.getElementById('ca').style.display = "block"
}


async function Autosend_new(){
    // disable button 
    document.getElementById('submit').innerHTML = `  <section class="dots-container">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                      </section> `;


            const userPitch = document.getElementById('userPitch').value; 
            // const token = 'YOUR_JWT_TOKEN'; // Replace with your actual JWT token
            const token = localStorage.getItem('authToken');
            const userTemplate = document.getElementById('userTemplate').value;
    const campaignName = generateUniqueCampaignName();
    // Example usage:
const campaignDetails = {
    email: U_MyEmail,
    campaignName: campaignName,
    template:userTemplate,
    pitch:userPitch
};

campaignId = await Campaign(campaignDetails);

console.log(campaignId)
localStorage.setItem('currentCampaignId', campaignId);

            const requestBody = {
                submittedData: submittedData,
                userPitch: userPitch,
                Uname: U_Username,
                token: token,
                myemail: U_MyEmail,
                campaignId: campaignId
            };
            
            // Example usage:


            // document.getElementById('statusMessage').textContent = 'Emails are being sent. You can close the tab.';
            showNotification('Emails are being sent. You can close the tab.')

            try {
                const response = await fetch('https://server.voltmailer.com/send-emails', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(requestBody)
                });

                if (response.ok) {
                    console.log('Email sending process started.');
                    document.getElementById('pr').style.display = `none`;
                    document.getElementById('sending').style.display = 'block';
                    //disable textarea 
                    // disable buttons 

                        // Get references to the button and textarea
                    // document.getElementById('inputButtons').style.display = "none";
                    const textarea = document.getElementById('userPitch');
                    const csv = document.getElementById('uploadLabel');
                    const man = document.getElementById('man');
                    textarea.disabled = true;
                    csv.disabled = true;
                    man.disabled = true;
                    // document.getElementById('hidewhengenerating').style.display = 'none';
                    document.getElementById('submit').innerHTML = ` 
                    
                    
                    

                                        <button class="button" onclick="NewCampaign()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                         New Campaign
                      </button>
`


                } else {
                    console.error('Error starting email sending process:', response.statusText);
                }
            } catch (error) {
                console.error('Error sending emails:', error);
                alert('Error sending emails');
            }
};




async function checkTaskStatus(taskId) {
  const response = await fetch(`/task-status/${taskId}`);
  const data = await response.json();

  if (data.state === 'PENDING' || data.state === 'PROGRESS') {
    setTimeout(() => checkTaskStatus(taskId), 1000);
  } else if (data.state === 'SUCCESS') {
    showNotification('All Emails Sent!');
    document.getElementById('submit').innerHTML = `<button class="button" onclick="Restart()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                       Send More
                      </button>
                      <h3>Sent!</h3>`;
  } else {
    showNotification(`Error: ${data.status}`);
    document.getElementById('submit').innerHTML = `<button class="button" onclick="Restart()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                       Retry
                      </button>
                      <h3>Error</h3>`;
  }
}



function updateRowStatus(index, string){
    console.log(index,string)
}
async function Restart() {
  submittedData = [];
  generatedData = [];
  document.getElementById('currentContent').style.display = 'block';
  document.getElementById('newContent').style.display = 'none';
  document.getElementById('togglewoggle').style.display = 'flex';
  document.getElementById('uploadLabel').style.display = "flex";
  document.getElementById('DOMAIN').style.display = "flex";
    document.getElementById('man').style.display = "flex";
    document.getElementById('export').style.display = "none";
  dataTable = document.getElementById('dataTable');
  dataTable.innerHTML=``;
  button.innerHTML=`<button class="button" onclick="SendEmails()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                       Generate
                      </button>`
}
// SENDING EMAILS MANUALLY



function showNewHtml() {
    document.getElementById('currentContent').style.display = 'none';
    document.getElementById('newContent').style.display = 'block';
    document.getElementById('tfoot').style.display = 'none';
    // document.getElementById('hidewhengenerating').style.display = 'none';
    populateEmailTable();
}

// function toggleDetails(index) {
//     const detailsRow = document.getElementById(`details-${index}`);
//     const arrowIcon = document.getElementById(`arrow-${index}`);
//     if (detailsRow.style.display === 'none' || detailsRow.style.display === '') {
//         detailsRow.style.display = 'table-row';
//         detailsRow.style.height = '0px';
//         arrowIcon.innerHTML = '';
//         setTimeout(() => {
//             detailsRow.style.transition = 'height 0.3s ease-out, opacity 0.3s ease-out';
//             detailsRow.style.height = detailsRow.scrollHeight + 'px';
//             detailsRow.style.opacity = '1';
//         }, 0);
//     } else {
//         detailsRow.style.transition = 'height 0.3s ease-out, opacity 0.3s ease-out';
//         detailsRow.style.height = '0px';
//         detailsRow.style.opacity = '0';
//         arrowIcon.innerHTML = '';
//         setTimeout(() => {
//             detailsRow.style.display = 'none';
//         }, 300);
//     }
// }

function separateSubject(input) {
    // Check if the input starts with "Subject: "
    const prefix = "Subject: ";
    if (input.startsWith(prefix)) {
        // Extract the actual subject line by removing the prefix
        const actualSubject = input.substring(prefix.length);
        return {
            prefix: prefix.trim(),
            subject: actualSubject.trim()
        };
    } else {
        // If the input does not start with "Subject: ", return null or handle accordingly
        return null;
    }
}

function generateUniqueCampaignName() {
    // Create a random string using `Math.random` and convert it to a hex-like format
    return `Campaign-${Math.random().toString(36).substring(2, 10)}`;
}


async function manualSend() {
    document.getElementById('uploadLabel').style.display = "none";
    document.getElementById('DOMAIN').style.display = "none";
    document.getElementById('man').style.display = "none";
    document.getElementById('export').style.display = "flex";
    // document.getElementById('ca').style.display = "none"
    const userPitch = document.getElementById('userPitch').value; // Get user pitch from textarea
    // const userPitch = document.getElementById('userPitch').value;
            const UserSubject = document.getElementById('UserSubject').value;
            const userTemplate = document.getElementById('userTemplate').value;

    document.getElementById('customLoader').style.display = 'flex';
    const textarea = document.getElementById('userPitch');
                    const csv = document.getElementById('uploadLabel');
                    const man = document.getElementById('man');
                    textarea.disabled = true;
                    csv.disabled = true;
                    man.disabled = true;

    // document.getElementById('togglewoggle').style.display = 'none';
    const button = document.getElementById('submit');
    showNewHtml();
    button.innerHTML = `<section class="dots-container">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                      </section> `;

    generatedData = [];

    const campaignName = generateUniqueCampaignName();
    // Example usage:
const campaignDetails = {
    email: U_MyEmail,
    campaignName: campaignName,
    template:userTemplate,
    pitch:userPitch
};

campaignId = await Campaign(campaignDetails);

console.log(campaignId)
localStorage.setItem('currentCampaignId', campaignId);


    for (let index = 0; index < submittedData.length; index++) {
        
        const data = submittedData[index];

        try {
            const sddata = submittedData[index];
            updateRowStatus(index, 'Personalizing message');
            const response = await fetch('https://server.voltmailer.com/generate-email-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        website: sddata.website, 
                        userPitch: userPitch, 
                        Uname: U_Username,
                        To: sddata.name,
                    Template : userTemplate})
                });

                if (!response.ok) {
                    throw new Error('Failed to generate email content');
                }

                const data_new = await response.json();
let subjectline = ""
if(UserSubject){
     subjectline = UserSubject
    console.log("if : ",subjectline)
}else{
     subjectline = separateSubject(data_new.subject_line).subject
    console.log("else : ", subjectline)
}
                // const subject_line = separateSubject(data_new.subject_line).subject
                const subject_line = subjectline
                // console.log(subject_line)
                const main_message = data_new.body_content

                console.log(main_message)


            generatedData.push({
                email: sddata.email,
                subject: subject_line,
                content: main_message
            });

            document.getElementById('loaderText').innerText = `Generating email for ${data.email}...`;
            await new Promise(resolve => setTimeout(resolve, 500)); // Simulate delay

            addEmailRow(generatedData.length - 1);
            // populateEmailTable();

        } catch (error) {
            console.error('Error generating email for', data.email, ':', error);
            showNotification(`Error generating email for ${data.email}`);
        }
    }
    document.getElementById('tfoot').style.display = 'block';
    document.getElementById('customLoader').style.display = 'none';
    // <button class="button" onclick="sendAllEmails()">
    //                     <i class="fi fi-rs-paper-plane"></i>
    //                     Send All
    //                 </button>
    button.innerHTML = `


                        <button class="button" onclick="sendAllEmails()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                        Send All
                      </button>

                `;
    // populateEmailTable();
}

function addEmailRow(index) {
    const data = generatedData[index];
    const tbody = document.getElementById('emailTable').getElementsByTagName('tbody')[0];

    const row = document.createElement('tr');
    console.log(data.content)
    row.innerHTML = `
        <td>${data.email}</td>
        <td class="action-buttons">
            <button onclick="sendEmailindex(${index})" class="button-icon">Send Now</button>
            <div class="tooltip">
                <button onclick="toggleDetails(${index})" class="button-icon" id="arrow-${index}"></button>
                <span class="tooltiptext">Show/Hide Details</span>
            </div>
        </td>
    `;
    tbody.appendChild(row);

    const detailsRow = document.createElement('tr');
    detailsRow.style.display = 'none';
    detailsRow.id = `details-${index}`;
    detailsRow.innerHTML = `
        <td colspan="2">
            <div class="details">
                <label>Subject:</label>
                <div class="editable-container">
                    <div class="editable text-container" id="subject-display-${index}">${data.subject}</div>
                    <span class="pencil-icon" id="subject-pencil-${index}" onclick="makeEditable('subject', ${index})"></span>
                </div>
                <label>Content:</label>
                <div class="editable-container">
                    <pre class="editable text-container" id="content-display-${index}" style="white-space: pre-wrap;">${data.content}</pre>
                    <span class="pencil-icon" id="content-pencil-${index}" onclick="makeEditable('content', ${index})"></span>
                </div>
            </div>
        </td>
    `;
    tbody.appendChild(detailsRow);
}






async function sendEmailindex(index) {

    if (generatedData.length === 0) {

                    // return;
                    document.getElementById('pr').style.display = `none`;
        document.getElementById('sending').style.display = 'block';
        document.getElementById('submit').innerHTML = ` 
        

                                        <button class="button" onclick="NewCampaign()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                         New Campaign
                      </button>


                        `;
    return
    


}
else {



    
    const data = generatedData[index];
    const subjectElement = document.getElementById(`subject-display-${index}`);
    const contentElement = document.getElementById(`content-display-${index}`);

    if (!subjectElement || !contentElement) {
        console.error(`Element(s) not found for index ${index}`);
        showNotification(`Error: Could not find elements to send email for index ${index}`);
        return;
    }

    // const subject = subjectElement.value;
    // const content = contentElement.value;
    const subject =    data.subject;
    const content =     data.content;

    console.log(subject, content)

    // Implement send logic here
    try {
        // updateRowStatus(index, 'Sending');
        const campaignId = localStorage.getItem('currentCampaignId');
        const result = await sendMessage('me', data.email, subject, content, campaignId);


        console.log('Message to ', data.email, ' successfully sent:', result);
        showNotification(`Message to ${data.email} successfully sent`);
        removeRow(index);

        if (generatedData.length === 0) {
                    // return;
                    document.getElementById('pr').style.display = `none`;
        document.getElementById('sending').style.display = 'block';
        document.getElementById('submit').innerHTML = ` 
        

                                        <button class="button" onclick="NewCampaign()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                         New Campaign
                      </button>


                        `;
    return
    

                    }

    } catch (error) {
            removeRow(index);
    //     console.error('Error sending email to', data.email, ':', error);
    //     showNotification(`Error sending email to ${data.email}`);
    }
}




}

// async function addEmailToCampaign(campaignId, emailDetails) {
//     try {
//         const response = await fetch(`/api/campaigns/${campaignId}/add-email`, {
//             method: 'POST',
//             headers: {
//                 'Content-Type': 'application/json'
//             },
//             body: JSON.stringify(emailDetails)
//         });

//         const data = await response.json();
//         if (response.ok) {
//             console.log('Email added:', data.message);
//         } else {
//             console.error('Failed to add email:', data.message);
//         }
//     } catch (error) {
//         console.error('Error:', error);
//     }
// }

// // Example usage:
// const emailDetails = {
//     recipientEmail: 'test@example.com',
//     subject: 'Welcome Email',
//     messageId: '12345',
//     threadId: '67890',
//     sentTime: '2024-10-25T10:00:00Z',
//     status: 'sent'
// };

// addEmailToCampaign('campaign_id_here', emailDetails);



async function Campaign(campaignDetails) {
    try {
        const response = await fetch('https://server.voltmailer.com/api/campaigns/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(campaignDetails)
        });

        const data = await response.json();
        if (response.ok) {
            console.log('Campaign created successfully:', data.campaignId);
            return data.campaignId
        } else {
            console.error('Failed to create campaign:', data.message);
        }
    } catch (error) {
        console.error('Error:', error);
    }
}






async function sendAllEmails() {
    
    const promises = generatedData.map((_, index) => sendEmailindex(index));

    try {
        await Promise.all(promises);
        showNotification('All emails sent successfully');
        document.getElementById('pr').style.display = `none`;
        document.getElementById('sending').style.display = 'block';
        document.getElementById('submit').innerHTML = ` 
        
        


                                        <button class="button" onclick="NewCampaign()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                         New Campaign
                      </button>

                    
                    `;
        // initialize()
    } catch (error) {
        console.error('Error sending one or more emails:', error);
        showNotification('Error sending one or more emails');
    }
}


function populateEmailTable() {

    // if (!generatedData[0]) {

    //                 return;
    // }


    const tbody = document.getElementById('emailTable').getElementsByTagName('tbody')[0];

    tbody.innerHTML = "";
    // tbody.style.overflow = "auto";
    generatedData.forEach((data, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${data.email}</td>
            <td class="action-buttons">
                <button onclick="sendEmailindex(${index})" class="button-icon">Send Now</button>
                <div class="tooltip">
                    <button onclick="toggleDetails(${index})" class="button-icon" id="arrow-${index}"></button>
                    <span class="tooltiptext">Show/Hide Details</span>
                </div>
            </td>
        `;
        tbody.appendChild(row);

        const detailsRow = document.createElement('tr');
        detailsRow.style.display = 'none';
        detailsRow.id = `details-${index}`;
        detailsRow.innerHTML = `
            <td colspan="2">
                <div class="details">
                    <label>Subject:</label>
                    <div class="editable-container">
                        <div class="editable text-container" id="subject-display-${index}">${data.subject}</div>
                        <span class="pencil-icon" id="subject-pencil-${index}" onclick="makeEditable('subject', ${index})"></span>
                    </div>
                    <label>Content:</label>
                    <div class="editable-container">
                        <div class="editable text-container" id="content-display-${index}">${data.content}</div>
                        <span class="pencil-icon" id="content-pencil-${index}" onclick="makeEditable('content', ${index})"></span>
                    </div>
                </div>
            </td>
        `;
        tbody.appendChild(detailsRow);
    });
}
// else {
    // document.getElementById('pr').style.display = `none`;
        // document.getElementById('sending').style.display = 'block';
        // document.getElementById('submit').innerHTML = ` <button class="button-g" onclick="NewCampaign()" id="submit">
                        // New Campaign
                    // </button>`;
    // return;
// }
// }

// function makeEditable(field, index) {
//     const displayElement = document.getElementById(`${field}-display-${index}`);
//     const pencilIcon = document.getElementById(`${field}-pencil-${index}`);
//     const value = displayElement.innerText;

//     if (field === 'content') {
//         displayElement.innerHTML = `<textarea id="${field}-${index}" rows="4" class="details editable">${value}</textarea>`;
//     } else {
//         displayElement.innerHTML = `<input type="text" id="${field}-${index}" value="${value}" class="details editable">`;
//     }
//     document.getElementById(`${field}-${index}`).style.pointerEvents = 'auto';
    
//     pencilIcon.innerText = '';
//     pencilIcon.onclick = function() { saveChanges(field, index); };
// }



function makeEditable(field, index) {
    const displayElement = document.getElementById(`${field}-display-${index}`);
    const pencilIcon = document.getElementById(`${field}-pencil-${index}`);
    const value = displayElement.innerText;

    displayElement.classList.add('edit-mode'); // Added line
    displayElement.setAttribute('contenteditable', 'true'); // Added line

    pencilIcon.innerText = '';
    pencilIcon.onclick = function() { saveChanges(field, index); };
}


// function saveChanges(field, index) {
//     const inputElement = document.getElementById(`${field}-${index}`);
//     const displayElement = document.getElementById(`${field}-display-${index}`);
//     const pencilIcon = document.getElementById(`${field}-pencil-${index}`);
//     if (inputElement) {
//         displayElement.innerHTML = inputElement.value.replace(/\n/g, '<br>');
//         generatedData[index][field] = inputElement.value;
//     }
//     inputElement.style.pointerEvents = 'none';
//     pencilIcon.innerText = '';
//     pencilIcon.onclick = function() { makeEditable(field, index); };
// }


function saveChanges(field, index) {
    const displayElement = document.getElementById(`${field}-display-${index}`);
    const pencilIcon = document.getElementById(`${field}-pencil-${index}`);

    displayElement.classList.remove('edit-mode'); // Added line
    displayElement.removeAttribute('contenteditable'); // Added line

    generatedData[index][field] = displayElement.innerText;
    
    pencilIcon.innerText = '';
    pencilIcon.onclick = function() { makeEditable(field, index); };
}

document.addEventListener('DOMContentLoaded', function () {
  const burgerButton = document.getElementById('burger-button');
  const menuToggle = document.getElementById('menu-toggle');

  burgerButton.addEventListener('click', function () {
    menuToggle.checked = !menuToggle.checked;
  });
});



function toggleDetails(index) {
    const detailsRow = document.getElementById(`details-${index}`);
    const arrowIcon = document.getElementById(`arrow-${index}`);

    if (detailsRow.style.display === 'none' || detailsRow.style.display === '') {
        detailsRow.style.display = 'table-row';
        arrowIcon.innerHTML = '';
        setTimeout(() => {
            detailsRow.style.transition = 'height 0.3s ease-out, opacity 0.3s ease-out';
            detailsRow.style.height = detailsRow.scrollHeight + 'px';
            detailsRow.style.opacity = '1';
        }, 0);
    } else {
        detailsRow.style.transition = 'height 0.3s ease-out, opacity 0.3s ease-out';
        detailsRow.style.height = '0px';
        detailsRow.style.opacity = '0';
        arrowIcon.innerHTML = '';
        setTimeout(() => {
            detailsRow.style.display = 'none';
        }, 300);
    }
}

function removeRow(index) {
    const row = document.getElementById(`details-${index}`).previousElementSibling;
    row.remove();
    document.getElementById(`details-${index}`).remove();
    generatedData.splice(index, 1);
}

function regenerateAllEmails() {
    const tbody = document.getElementById('emailTable').getElementsByTagName('tbody')[0];
    tbody.innerHTML = "";
    generatedData = [];
    manualSend();
}

function exportToExcel() {
    // Create a new workbook and a worksheet
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.json_to_sheet(generatedData, {
        header: ["email", "subject", "content"]
    });

    // Append the worksheet to the workbook
    XLSX.utils.book_append_sheet(wb, ws, "Emails");

    // Generate a file and prompt the user to save it
    XLSX.writeFile(wb, "emails.xlsx");
}


async function CallThisWhenAutosend() {
    document.getElementById('sendAllBtn').innerHTML = `<div class="loader"></div>`;
    for (let index = 0; index < generatedData.length; index++) {
        const data = generatedData[index];
        try {
            updateRowStatus(index, 'Sending');
            const result = await sendMessage('me', data.email, data.subject, data.content);
            console.log('Message to ', data.email, ' successfully sent:', result);
            showNotification(`Message to ${data.email} successfully sent`);
            removeRow(index);
        } catch (error) {
            console.error('Error sending email to', data.email, ':', error);
            showNotification(`Error sending email to ${data.email}`);
        }
    }
    // document.getElementById('sendAllBtn').innerHTML = 'Send All';
}

// document.getElementById('sendAllBtn').addEventListener('click', CallThisWhenAutosend);
// document.getElementById('regenerateAllBtn').addEventListener('click', regenerateAllEmails);


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
async function sendMessage(sender, to, subject, messageText, campaignId) {

    const token = localStorage.getItem('authToken');
    const response = await fetch('https://server.voltmailer.com/send-bulk-manual', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ token: token , email: to, subject: subject, content: messageText, myemail: U_MyEmail, campaignId: campaignId })
    });



    if (!response.ok) {
        throw new Error('Network response was not ok ' + response.statusText);
    }

    const result = await response.json();

    console.log('Message sent, ID:', result.id);
    return result;


}

      async function useEmails(numUsedUp) {
            // const email = document.getElementById('emailInput').value;
            // const emailsToUse = parseInt(document.getElementById('emailsToUseInput').value);

            const response = await fetch('/use_email', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email: '{{email}}', emails_to_use: numUsedUp })
            });

            const result = await response.json();
            // alert(result.message);
            showNotification(`${result.message}`)
        }

      function sendEmails(SENT_EMAILS) {
        OutputsData.forEach(data => {
          const service = '{{ service }}'
          const message = create_message('me', data.email, data.subject, data.content)
          send_message(service, 'me', message)
          console.log('Email sent successfully!')
        })
        console.log('Emails sent successfully!')
        button.innerHTML=`Sent`
        useEmails(SENT_EMAILS);
      }


// //// MAIN STUFF
// function billing(){

// // mainContent.innerHTML = document.getElementById('billing').innerHTML;
// const url = 'https://billing.stripe.com/p/login/bIY15e8DBdSv8SY6oo';
//                     window.open(url, '_blank'); 
//         }

async function billing(stripeID, Email) {
    const response = await fetch('https://server.voltmailer.com/create-billing-portal-session', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ customerId: stripeID, email: Email })
    });

    if (response.ok) {
        const data = await response.json();
        // window.location.href = data.url;
        window.open(data.url, '_blank');

    } else {
        const errorData = await response.json();
        console.error('Error:', errorData.error);
        alert('Failed to create billing portal session: ' + errorData.error);
    }
}


       async function customerportal(){

            const customerId = UserStripeID; // Fetch this from your database or session

            const response = await fetch('https://server.voltmailer.com/create-billing-portal-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ customerId }),
            });

            const data = await response.json();
            console.log("data")

            if (data.url) {
                // window.location.href = data.url;
                window.open(data.url, '_blank');
            } else {
                console.error('Failed to create billing portal session:', data.error);
            }
        };


function initialize() {

    let button = document.getElementById('submit')
            total_emails = '{{ total_emails }}'
            plan = '{{ plan_emails}}'
            name = '{{ name }}'
            console.log(total_emails, '{{ name }}')

            if (total_emails == 0) {
                button.innerHTML=`                    <button class="button" onClick="billing()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                        Unlock Pro
                      </button>`
            }
            else {
                button.innerHTML=`<!-- <button class="btn">
                        <svg height="24" width="24" fill="#FFFFFF" viewBox="0 0 24 24" data-name="Layer 1" id="Layer_1" class="sparkle">
                            <path d="M10,21.236,6.755,14.745.264,11.5,6.755,8.255,10,1.764l3.245,6.491L19.736,11.5l-6.491,3.245ZM18,21l1.5,3L21,21l3-1.5L21,18l-1.5-3L18,18l-3,1.5ZM19.333,4.667,20.5,7l1.167-2.333L24,3.5,21.667,2.333,20.5,0,19.333,2.333,17,3.5Z"></path>
                        </svg>
                    
                        <span class="text">Generate</span>
                    </button> -->
                    
                    <button class="button" onclick="Submitandcheckautosend()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                        Generate
                      </button>`
            }
            showNotification(`Welcome, ${name}`)
        }
        // initialize();

function showNotification(message) {
            //   const name = "{{ name }}";
            //     const container = document.getElementById('notification-container-pop');
            //     const notification = document.createElement('div');
            //     notification.className = 'notification-pop';
                
            //     const closeButton = document.createElement('span');
            //     closeButton.className = 'close-button';
            //     closeButton.textContent = '';
            //     closeButton.onclick = () => notification.remove();

            //     notification.appendChild(closeButton);
            //     notification.appendChild(document.createTextNode(message));

            //     container.appendChild(notification);

            //     setTimeout(() => {
            //         notification.style.opacity = 0;
            //         notification.style.transform = 'translateY(-20px)';
            //         notification.addEventListener('transitionend', () => notification.remove());
            //     }, 5000);
            };


            
    </script>
</head>
<body>
    <div class="top-bar"></div>
    <div id="notification-container-pop"></div>

    <div class="manual-popup-overlay" id="manual-popup-overlay">
        <div class="container">
            <button style="top: 0px; left:10px; background: none; color: #000;" onclick="togglePopupManual()">X</button>
            <h2 style="align-self: center; margin-bottom: 10px;">Manual Lead Entry</h2>
            <!-- <button id="closePopup" class="close-popup" onclick="togglePopupManual()">X</button> -->
            <!-- <div class="heading">Add Manually</div> -->
            <!-- <form class="form" action=""> -->
              <!-- <div class="input-field">
                <input
                  required=""
                  autocomplete="off"
                  type="text"
                  name="text"
                  id="name"
                />
                <label for="username">Name</label>
              </div> -->

              <div class="coolinput">
                <label for="input" class="text">Name:</label>
                <input type="text" placeholder="Joe Smith" name="input" class="input" id="name">
            </div>

            <div class="coolinput">
                <label for="input" class="text">Email:</label>
                <input type="text" placeholder="Example@email.com" name="input" class="input" id="emailinput">
                <!-- <input placeholder="Email address" class="input" name="text" type="email" placeholder="CoolGuy1@email.com"/> -->

            </div>              
            
            <div class="coolinput">
                <label for="input" class="text">Website:</label>
                <input type="text" placeholder="Voltmailer.com" name="input" class="input" id="website" >
            </div>
              <!-- <div class="input-field">
                <input
                  required=""
                  autocomplete="off"
                  type="text"
                  name="email"
                  id="email"
                />
                <label for="email">Email</label>
              </div>
              <div class="input-field">
                <input
                  required=""
                  autocomplete="off"
                  type="text"
                  name="text"
                  id="website"
                  value="https://"
                />
                <label for="username">Website</label>
              </div> -->


              <button onclick="Manual()">Submit
                <div class="arrow-wrapper">
                    <div class="arrow"></div>
                </div>
            </button>
              <div class="btn-container">

                <div class="acc-text">
                    <span style="color : #ff0000; cursor : pointer;"  id="manualError"></span>
                </div>
              </div>



            <!-- </form> -->
          </div>
          
      </div>

      <div class="manual-popup-overlay domain" id="manual-popup-overlay-domain">
        <div class="container">
            <button style="top: 0px; left:10px; background: none; color: #000;" onclick="togglePopupDomain()">X</button>
        <div class="center" >

            <h1 style="font-size: 20px; margin-bottom:20px;">Enter Domain to Search for Emails</h1>
            <form id="emailForm" style="display: flex;flex-direction: row;">
                <input type="text" id="domain" name="domain" placeholder="Enter domain" required style="height: 100%;">
                <button type="submit" style="margin-top: 0; height: 100%; width: 35%;"><i class="fi fi-rr-arrow-right" style="padding-left: 10px;     height: 14px; width: 14px;"></i></button>
            </form>
            <div id="results" style="color: red;"></div>

            
         <!-- <label class="custum-file-upload" for="fileMIDDLE">
            <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="" viewBox="0 0 24 24"><g stroke-width="0" id="SVGRepo_bgCarrier"></g><g stroke-linejoin="round" stroke-linecap="round" id="SVGRepo_tracerCarrier"></g><g id="SVGRepo_iconCarrier"> <path fill="" d="M10 1C9.73478 1 9.48043 1.10536 9.29289 1.29289L3.29289 7.29289C3.10536 7.48043 3 7.73478 3 8V20C3 21.6569 4.34315 23 6 23H7C7.55228 23 8 22.5523 8 22C8 21.4477 7.55228 21 7 21H6C5.44772 21 5 20.5523 5 20V9H10C10.5523 9 11 8.55228 11 8V3H18C18.5523 3 19 3.44772 19 4V9C19 9.55228 19.4477 10 20 10C20.5523 10 21 9.55228 21 9V4C21 2.34315 19.6569 1 18 1H10ZM9 7H6.41421L9 4.41421V7ZM14 15.5C14 14.1193 15.1193 13 16.5 13C17.8807 13 19 14.1193 19 15.5V16V17H20C21.1046 17 22 17.8954 22 19C22 20.1046 21.1046 21 20 21H13C11.8954 21 11 20.1046 11 19C11 17.8954 11.8954 17 13 17H14V16V15.5ZM16.5 11C14.142 11 12.2076 12.8136 12.0156 15.122C10.2825 15.5606 9 17.1305 9 19C9 21.2091 10.7909 23 13 23H20C22.2091 23 24 21.2091 24 19C24 17.1305 22.7175 15.5606 20.9844 15.122C20.7924 12.8136 18.858 11 16.5 11Z" clip-rule="evenodd" fill-rule="evenodd"></path> </g></svg>
            </div>
            <div class="text">
               <span>Click to upload Csv</span>
               </div>
               <input type="file" id="fileMIDDLE"  accept=".xlsx" >
            </label>  -->

        </div> 
        </div>
        <div class="btn-container">

            <div class="acc-text">
                <span style="color : #ff0000; cursor : pointer;"  id="manualErrorm"></span>
            </div>
          </div>
      </div>

    <div class="sidebar">
        <div class="div">
        <div class="logo">
            <!-- <img src="Volt.png" alt="Logo"> -->
            <img  src='vmb.png' alt="google" style="width: 170px; height: 90px;">
            <!-- <div>Voltmailer</div> -->
        </div>
        <div class="menu" id="sidemenu">
            <!-- <div class="menu-item">Menu</div> -->
             <button onclick="createCampaign()" >+ New Campaign</button>
            <div class="menu-item active" id="1"><i class="fi fi-ts-house-chimney"></i>Home</div>
            <div class="menu-item" id="2"> <i class="fi fi-tr-rocket-lunch"></i>New Campaign</div>
            <!-- <div class="menu-item" id="5"> <i class="fi fi-tr-rocket-lunch"></i>Email Templates</div> -->
         
            <div class="menu-item" id="3" onclick="billing()"> <i class="fi fi-tr-credit-card-eye"></i> Billing</div>
            <!-- <div class="menu-item tools">Tools</div> -->
            <div class="menu-item" id="4" style="border-top: 1px solid #0000003a;"><i class="fi fi-tr-user-pen"></i>Account</div>
            <!-- <div class="menu-item end" id="5"><i class="fi fi-rr-customer-service"></i>Help</div> -->
        </div>
    </div>
        <!-- upsell ?? -->
        <!-- <div class="upsell">
            <div class="upsell-content">
                <span>Upgrade</span>
                <div class="upsell-close">
                    <span>&times;</span>
                </div>
            </div>
        </div> -->
        <!-- <div class="bottom3"> -->

            <!-- #help -->
            <!-- #setting -->
            <!-- #signout -->
        <!-- </div> -->
        <div class="menu-item logout" id="5" onclick="logout()" style=" padding-left: 0; margin-left: 0; "><i class="fi fi-tr-arrow-square-right"></i>Logout</div>
    </div>


    <div class="dashboard">


        <div class="navtop" id="mobile-nav">
            <img src="vmb.png" alt="Logo">
            
        <div class="burger">
            <!-- <img src="google.png" alt="google"> -->
<label class="popup-1">
  <input type="checkbox">
  <div class="burger" tabindex="0">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <nav class="popup-window">
    <legend>Menu</legend>
    <ul>
      <li>
        <button onclick="GoHome()">
          <!-- <svg stroke-linejoin="round" stroke-linecap="round" stroke-width="2" stroke="currentColor" fill="none" viewBox="0 0 24 24" height="14" width="14" xmlns="http://www.w3.org/2000/svg">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle r="4" cy="7" cx="9"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg> -->
          <i class="fi fi-ts-house-chimney"></i>
          <p>Home</p>
        </button>
      </li>
      <li>
        <button onclick="createCampaign()">
          <!-- <svg stroke-linejoin="round" stroke-linecap="round" stroke-width="2" stroke="currentColor" fill="none" viewBox="0 0 24 24" height="14" width="14" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
          </svg> -->
          <i class="fi fi-tr-rocket-lunch"></i>
          <p>New Campaign</p>
        </button>
      </li>
      <hr>
      <li>
        <button onclick="billing()">
          <!-- <svg stroke-linejoin="round" stroke-linecap="round" stroke-width="2" stroke="currentColor" fill="none" viewBox="0 0 24 24" height="14" width="14" xmlns="http://www.w3.org/2000/svg">
            <rect ry="2" rx="2" height="13" width="13" y="9" x="9"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg> -->
          <i class="fi fi-tr-credit-card-eye"></i>
          <p>Billing</p>
        </button>
      </li>
      <li>
        <button onclick="OpenAccount()">
          <!-- <svg stroke-linejoin="round" stroke-linecap="round" stroke-width="2" stroke="currentColor" fill="none" viewBox="0 0 24 24" height="14" width="14" xmlns="http://www.w3.org/2000/svg">
            <polygon points="16 3 21 8 8 21 3 21 3 16 16 3"></polygon>
          </svg> -->
          <i class="fi fi-tr-user-pen"></i>
          <p>Account</p>
        </button>

      </li>
      <hr>
      <li>
        <button id="burger-button">
          <svg stroke-linejoin="round" stroke-linecap="round" stroke-width="2" stroke="currentColor" fill="none" viewBox="0 0 24 24" height="14" width="14" xmlns="http://www.w3.org/2000/svg">
            <line y2="18" x2="6" y1="6" x1="18"></line>
            <line y2="18" x2="18" y1="6" x1="6"></line>
          </svg>
          <p>Close Menu</p>
        </button>
      </li>
    </ul>
  </nav>
</label>
        </div>
            
        </div>

        <div class="top" id="maintop">
           
            <div class="google" id="googleauthid">
                <div onclick="ConnectGoogle()" style="cursor: pointer; text-decoration: underline;"> Please connect your gmail Account</div>

                <!-- <button class="button" onclick="ConnectGoogle()">
                    <img  src='google.png' alt="google" style="height= 30px; width: 30px;">
                    Connect Google
                </button> -->

                <!-- <img  src='../static/google.png' alt="google"> -->
                <!-- {{ email }} -->
            </div>
            <!-- <div class="plan">New Campaign</div> -->
        </div>

        <div class="contentf" id="myUsage-content" style="display: none;">
            <!-- <div class="welcome-content-row">
            <div class="welcome">
            <p>Welcome </p>
            <h2 id="h2name"> </h2> 
            </div>
            <div class="buttons" id="inputButtons">

                <button class="button-man" onclick="togglePopupManual()" id="man">+ New lead</button>

                <label for="fileInput" id="uploadLabel"  > + Import leads</label>
                <input type="file" id="fileInput" accept=".xlsx,.csv" style="display: none;">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
                
            </div>
            </div> -->
            <div class="pitch-row" >
                
                <div class="content-row" >
                <span id="sending" style="display: none;">Emails are sending, you can close this tab.</span>
                    <div id="pr" >
                    
                    <!-- <div id="newContent" >
                        <h1>Your Emails</h1>
                        <table id="emailTable">
                            <thead >
                                <tr>
                                    <th>Recipient Email</th>
                                </tr>
                            </thead>
                            <tbody>
                           
                            </tbody>
                        </table>
                        <button id="regenerateAllBtn" onclick='regenerateAllEmails()'>Regenerate All Emails</button>
                        <button onclick="Restart()" >Reset</button>
                        <div class="custom-loader" id="customLoader" style="display: none;">
                            <div class="load-inner load-one"></div>
                            <div class="load-inner load-two"></div>
                            <div class="load-inner load-three"></div>
                            <span class="text" id="loaderText"></span>
                        </div>
                    </div> -->

                    <div id="newContent" style="display: none;">
                        <h1>Your Emails</h1>
                        <table id="emailTable">
                            <thead>
                                <tr>
                                    <th>Recipient Email</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows will be populated here -->
                            </tbody>
                            <tfoot id="tfoot">
                                <tr>
                                    <td colspan="2">
                                        <button id="regenerateAllBtn" onclick='regenerateAllEmails()'>Regenerate All Emails</button>
                                        <button onclick="NewCampaign()">Reset</button>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                        <div class="custom-loader" id="customLoader" style="display: none;">
                            <div class="load-inner load-one"></div>
                            <div class="load-inner load-two"></div>
                            <div class="load-inner load-three"></div>
                            <span class="text" id="loaderText"></span>
                        </div>
                    </div>


                    <div id="currentContent">
                        <table id="dataTable" >
                        <div class="center" id="center">

                            <!-- <h1>Enter Domain to Search for Emails</h1>
                            <form id="emailForm">
                                <input type="text" id="domain" name="domain" placeholder="Enter domain" required>
                                <button type="submit">Get Emails</button>
                            </form>
                            <div id="results"></div> -->

                            
                         <label class="custum-file-upload" for="fileMIDDLE">
                            <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="" viewBox="0 0 24 24"><g stroke-width="0" id="SVGRepo_bgCarrier"></g><g stroke-linejoin="round" stroke-linecap="round" id="SVGRepo_tracerCarrier"></g><g id="SVGRepo_iconCarrier"> <path fill="" d="M10 1C9.73478 1 9.48043 1.10536 9.29289 1.29289L3.29289 7.29289C3.10536 7.48043 3 7.73478 3 8V20C3 21.6569 4.34315 23 6 23H7C7.55228 23 8 22.5523 8 22C8 21.4477 7.55228 21 7 21H6C5.44772 21 5 20.5523 5 20V9H10C10.5523 9 11 8.55228 11 8V3H18C18.5523 3 19 3.44772 19 4V9C19 9.55228 19.4477 10 20 10C20.5523 10 21 9.55228 21 9V4C21 2.34315 19.6569 1 18 1H10ZM9 7H6.41421L9 4.41421V7ZM14 15.5C14 14.1193 15.1193 13 16.5 13C17.8807 13 19 14.1193 19 15.5V16V17H20C21.1046 17 22 17.8954 22 19C22 20.1046 21.1046 21 20 21H13C11.8954 21 11 20.1046 11 19C11 17.8954 11.8954 17 13 17H14V16V15.5ZM16.5 11C14.142 11 12.2076 12.8136 12.0156 15.122C10.2825 15.5606 9 17.1305 9 19C9 21.2091 10.7909 23 13 23H20C22.2091 23 24 21.2091 24 19C24 17.1305 22.7175 15.5606 20.9844 15.122C20.7924 12.8136 18.858 11 16.5 11Z" clip-rule="evenodd" fill-rule="evenodd"></path> </g></svg>
                            </div>
                            <div class="text">
                               <span>Click to upload Csv</span>
                               </div>
                               <input type="file" id="fileMIDDLE"  accept=".xlsx" >
                            </label> 

                        </div>  
                        
                        <thead id="thead" >
                        </thead>  
                        <tbody id="tablerows">
                          
                        </tbody>
                    </table>
                </div>

                </div>
            </div>


                <div class="pitch">  
                    <div class="buttons" id="inputButtons">

                        <button class="button-man" onclick="togglePopupManual()" id="man"><div class="lead"> + New lead</div></button>
        
                        <label for="fileInput" id="uploadLabel" class="uploadLabel" ><div class="lead"> + Import leads</div></label>
                        <input type="file" id="fileInput" accept=".xlsx" style="display: none;">

                        <button class="uploadLabel"  onclick="exportToExcel()" id="export" style="display: none; width: 100%;"><div class="lead"> Export Generated Data  </div></button>


            <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
                        
                    </div>
                    <!-- <span>Or</span> -->
                    <div class="buttons" id="inputButtons">

                        <button class="button-man" onclick="togglePopupDomain()" id="DOMAIN" style="width: 100%;"><div class="lead"> + Add from Domain</div></button>      
                    </div>
                    <!-- <div class=""></div> -->
                    
                    <textarea id="userPitch" class="pitch-text" name="user_pitch"           placeholder="Enter Your Pitch Here
    Recommended:
    - Include desired outcome from Email, ect : 
        I want to get my clients on a 5 min call
    - What you do
    - Any guarntees you have"  required></textarea>
<h5>Optional</h5>
<textarea id="UserSubject" class="pitch-text" name="user_pitch" placeholder="Enter a preferred subject line..." required></textarea>
<textarea id="userTemplate" class="pitch-text" name="user_pitch" placeholder="Add an Email Template..." required></textarea>

                    <!-- <span style="text-align: left; padding-left: 10px; color: #000;"> For best results provide: </span>
                    <span style="text-align: left; padding-left: 20px;"> - Clear offer to prospect or pain-point that you are solving for them. </span>
                    <span style="text-align: left; padding-left: 20px;"> - Clear call to action the prospect should take.</span> -->
                    <div id="submit">
                        
                        <button class="button" onclick="logout()" id="submit" style="font-size: 18px; text-align: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                              <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                            </svg>
                            Your Session has expired <br>Please log in again
                        </button>
                    </div>
                    <!-- <button class="button" onclick="Submitandcheckautosend()" id="submit">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
                          <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
                        </svg>
                        Generate
                    </button> -->


                      
                    <div class="nobg-submit" id="hidewhengenerating">
                        <div class="checkbox-wrapper-46">
                          <input type="checkbox" id="cbx-46" class="inp-cbx" onchange="checkbox()" />
                          <label for="cbx-46" class="cbx"
                            ><span>
                              <svg viewBox="0 0 12 10" height="10px" width="12px">
                                <polyline points="1.5 6 4.5 9 10.5 1"></polyline></svg></span
                            ><span> <div id="autosend-text">Autosend is <b>OFF</b></div> </span>
                          </label>
                        </div>
                        <!-- <div id="ca" onclick="reset()" class="Clear-all">Clear all</div> -->
                    </div>
                   
                </div>
            </div>
        </div>


        <div  class="contentf" id="main"  >
            <div class="pitch-row" >
                
                <div class="content-row" style="border: none; box-shadow: none; "> 

                    <div >
                        <h1 style="color: black; font-size: 40px; margin-bottom: 10px;">Home</h1>
                        <h3 style="margin-block: 30px;" class="">Quick Actions  ?</h3>
                        <div  style="display: flex; align-items: center; justify-content: start; flex-direction: row; width: 95%; gap: 10px;">
                            <button class="button-man " onclick="OpenAccount()" id="man" ><div class="lead"> Account Settings</div></button>
                            <button class="button-man "  id="billing-man" ><div class="lead"> Plan Details  </div></button>
                            <button class="uploadLabel " onclick="createCampaign()" id="man"><div class="lead"> + New lead</div></button>
                        </div>
                                                     <!-- <div style=" display: flex; flex-direction: row; gap: 20px;">
                                <div class="metric">

                                    <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Total Emails Used</p>
                                    <h2 class="metric-value" id="metric-label-total">11 / 1000</h2>
                                </div>
                                <div class="metric">
              
                                    <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Reply Rate</p>
                                    <h2 class="metric-value" id="metric-label-rr">65%</h2>
                                </div>
                                 <div class="metric">
              
                                    <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Bounce Rate</p>
                                    <h2 class="metric-value" id="metric-label-br">0%</h2>
                                </div>
                            </div>  -->
                            <div  class="reports">
                            <div class="small-details-card-grid">
                                <div
                                  id="w-node-_9745c905-0e47-203d-ac6e-d1bee1ec357d-e1ec357d"
                                  class="card top-details report-card"
                                >
                                  <div class="flex-horizontal justify-space-between">
                                    <div class="flex align-center gap-column-4px">
                                      <img
                                        src="https://cdn.prod.website-files.com/670a6eaff9d5ba109641ceec/670a6eaff9d5ba109641cfd0_pageviews-icon-dashdark-webflow-template.svg"
                                        loading="eager"
                                        alt="Pageviews - Dashdark X Webflow Template"
                                        class="max-h-16px"
                                      />
                                      <div class="text-100 medium mg-top-2px">Emails Delivered</div>
                                    </div>
                                    <div class="dashdark-custom-icon details-icon"></div>
                                  </div>
                                  <div class="flex align-center gap-column-6px">
                                    <div class="display-4" id="ed">50.8K</div>
                                    <div>
                                      <!-- <div class="status-badge green">
                                        <div class="flex align-center gap-column-4px">
                                          <div class="paragraph-small">28.4%</div>
                                        </div>
                                        <div class="dashdark-custom-icon icon-size-9px"></div>
                                      </div> -->
                                    </div>
                                  </div>
                                </div>
                                <!-- <div
                                  id="w-node-_9745c905-0e47-203d-ac6e-d1bee1ec357d-e1ec357d"
                                  class="card top-details"
                                >
                                  <div class="flex-horizontal justify-space-between">
                                    <div class="flex align-center gap-column-4px">
                                      <img
                                        src="https://cdn.prod.website-files.com/670a6eaff9d5ba109641ceec/670a6eaff9d5ba109641cfd3_monthly-users-icon-dashdark-webflow-template.svg"
                                        loading="eager"
                                        alt="Monthly Users - Dashdark X Webflow Template"
                                        class="max-h-16px"
                                      />
                                      <div class="text-100 medium mg-top-2px">Reply Rate</div>
                                    </div>
                                    <div class="dashdark-custom-icon details-icon"></div>
                                  </div>
                                  <div class="flex align-center gap-column-6px">
                                    <div class="display-4" id="rr">23.6K</div>
                                    <div>
                                       <div class="status-badge red">
                                        <div class="flex align-center gap-column-4px">
                                          <div class="paragraph-small">12.6%</div>
                                        </div>
                                        <div class="dashdark-custom-icon icon-size-9px"></div>
                                      </div> 
                                    </div>
                                  </div>
                                </div> -->
                                <div
                                  id="w-node-_9745c905-0e47-203d-ac6e-d1bee1ec357d-e1ec357d"
                                  class="card top-details"
                                >
                                  <div class="flex-horizontal justify-space-between">
                                    <div class="flex align-center gap-column-4px">
                                      <img
                                        src="https://cdn.prod.website-files.com/670a6eaff9d5ba109641ceec/670a6eaff9d5ba109641cfd2_new-sign-ups-icon-dashdark-webflow-template.svg"
                                        loading="eager"
                                        alt="New Sign Ups - Dashdark X Webflow Template"
                                        class="max-h-16px"
                                      />
                                      <div class="text-100 medium mg-top-2px">Campaigns Sent</div>
                                    </div>
                                    <div class="dashdark-custom-icon details-icon"></div>
                                  </div>
                                  <div class="flex align-center gap-column-6px">
                                    <div class="display-4" id="cs">756</div>
                                    <div>
                                      <!-- <div class="status-badge green">
                                        <div class="flex align-center gap-column-4px">
                                          <div class="paragraph-small">3.1%</div>
                                        </div>
                                        <div class="dashdark-custom-icon icon-size-9px"></div>
                                      </div> -->
                                    </div>
                                  </div>
                                </div>
                                <!-- <div
                                  id="w-node-_9745c905-0e47-203d-ac6e-d1bee1ec357d-e1ec357d"
                                  class="card top-details"
                                >
                                  <div class="flex-horizontal justify-space-between">
                                    <div class="flex align-center gap-column-4px">
                                      <img
                                        src="https://cdn.prod.website-files.com/670a6eaff9d5ba109641ceec/670a6eaff9d5ba109641cfd1_subscriptions-icon-dashdark-webflow-template.svg"
                                        loading="eager"
                                        alt="Subscriptions - Dashdark X Webflow Template"
                                        class="max-h-16px"
                                      />
                                      <div class="text-100 medium mg-top-2px">Bounce Rate</div>
                                    </div>
                                    <div class="dashdark-custom-icon details-icon"></div>
                                  </div>
                                  <div class="flex align-center gap-column-6px">
                                    <div class="display-4" id="br">2.3K</div>
                                    <div>
                             
                                    </div>
                                  </div>
                                </div> -->
                              </div>
                              </div>
                        <div class="plan-usage">
                            <h2 style="margin-bottom: 5px; color: #000;">Plan: <b style="color: #5e5e5e" id="metric-label-plan">Premium</b></h2>
                            <p class="plan-usage-detail" id="plan-usage-detail">6,547 of 10,000 emails used this month</p>
                            <div class="progress-text" id="progress-text">
                              <p>Current: 6,547</p>
                              <p>Total: 1000</p>
                            </div>
                            <div class="progress-barx">
                                <div id="progressx" style="width: 57.3%;"></div>
                            </div>
                            <!-- <button class="button-man " id="subscription" >Upgrade</button> -->
                            <button  id="subscription" >Upgrade</button>
                        </div>
                        <div class="attract">
                            <div class="row-1" >
                                <h2 class="smaller-mobile" style="margin-bottom: 20px;">Attract and win customers with targeted campaigns</h2>
                                <button class="button-man" onclick="createCampaign()" id="man"><div class="lead"> + New Campaign</div></button>
                            </div>
                            <div class="mc-img">
                                <img src="mail-inbox.png" alt="" class="mailchimp">
                            </div>
                            <!-- below when we have metrics to display -->

                        </div>
                    </div>


                </div>


                <!-- <div class="pitch" style=" background: #ffffff;
                -webkit-box-shadow: 12px 12px 33px #cccccc, -12px -12px 33px #ffffff;
                box-shadow: 12px 12px 33px #cccccc, -12px -12px 33px #ffffff; display: flex; align-items: center; justify-content: start;">
                
                <h3 style="margin-top: 20px;">Your Progress</h3>
              
                <div>
                    <h2>75%</h2>
                </div>
                <div style="width: 100%; height: 1px; background-color: #5e5e5e49;"></div>

                <div style="display: flex; flex-direction: row; align-items: center; justify-content: space-between; width: 90%;">
                    <h3>Send your first Email</h3>
                    <i class="fi fi-ss-hexagon-check" id="accountTick"></i>
                </div>

                </div> -->



                <!-- <div class="pitch" style="background: #ffffff; border-radius: 16px;
                -webkit-box-shadow: 12px 12px 33px #cccccc, -12px -12px 33px #ffffff;
                box-shadow: 12px 12px 33px #cccccc, -12px -12px 33px #ffffff;
                display: flex; flex-direction: column; align-items: center; padding: 20px;">
        
                <h3 style="margin-top: 20px;">Your Progress</h3>
              
                <div id="progress-circle" style="position: relative; width: 100px; height: 100px;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        <h2 id="progress-percentage">0%</h2>
                    </div>
                </div>
                <div style="width: 100%; height: 1px; background-color: #5e5e5e49; margin: 5px 0;"></div>
        
                <div class="task" data-task-id="1" >
                    <h3 > Send your first Email</h3>
                    <i class="fi fi-ss-hexagon" onclick="toggleDetailsx(this)" id="task-icon-1" style=" cursor: pointer; color: #5e5e5e;"></i>
                </div>
                
                <div class="task-details" data-task-id="1" style="display: none; width: 90%;">
                    <button onclick="createCampaign()">Send Email</button>
                </div>
        
                <div class="task" data-task-id="2" style="display: flex; flex-direction: row; align-items: center; justify-content: space-between; width: 90%;">
                    <h3>Create your first Campaign</h3>
                    <i class="fi fi-ss-hexagon" onclick="toggleDetailsx(this)" id="task-icon-2"></i>
                </div>
                <div class="task-details" data-task-id="2" style="display: none; width: 90%;">
                    <button onclick="createCampaign()">Create Campaign</button>
                </div>
        
                <div class="task" data-task-id="3" style="display: flex; flex-direction: row; align-items: center; justify-content: space-between; width: 90%;">
                    <h3>Edit your Username</h3>
                    <i class="fi fi-ss-hexagon" onclick="toggleDetailsx(this)" id="task-icon-3"></i>
                </div>
                <div class="task-details" data-task-id="3" style="display: none; width: 90%;">
                    <button onclick="editUsername()">Edit Username</button>
                </div>
            </div> -->
        
              
            </div>
    </div>

    <div  class="contentf" id="template" style="display: none;"  >
        <div class="pitch-row" >
            
            <div class="content-row" style="border: none; box-shadow: none; "> 

                <div >
                    <h1 style="color: black; font-size: 40px; margin-bottom: 10px;">My Templates</h1>
                    <h3 style="margin-block: 30px;" class="">Help  ?</h3>
                    <div  style="display: flex; align-items: center; justify-content: start; flex-direction: row; width: 95%; gap: 10px;">
                        <button class="button-man " onclick="OpenAccount()" id="man" ><div class="lead"> Account Settings</div></button>
                        <button class="button-man "  id="billing-man" ><div class="lead"> Plan Details  </div></button>
                        <button class="uploadLabel " onclick="createCampaign()" id="man"><div class="lead"> + New lead</div></button>
                    </div>
                    <div class="plan-usage">
                        <h2 style="margin-bottom: 5px; color: #000;">Plan: <b style="color: #5e5e5e" id="metric-label-plan">Premium</b></h2>
                        <p class="plan-usage-detail" id="plan-usage-detail">6,547 of 10,000 emails used this month</p>
                        <div class="progress-text" id="progress-text">
                          <p>Current: 6,547</p>
                          <p>Total: 1000</p>
                        </div>
                        <div class="progress-bar">
                            <div id="progress" style="width: 57.3%;"></div>
                        </div>
                        <!-- <button class="button-man " id="subscription" >Upgrade</button> -->
                        <button  id="subscription" >Upgrade</button>
                    </div>
                    <div class="attract">
                        <div class="row-1" >
                            <h2 class="smaller-mobile" style="margin-bottom: 20px;">Attract and win customers with targeted campaigns</h2>
                            <button class="button-man" onclick="createCampaign()" id="man"><div class="lead"> + New Campaign</div></button>
                        </div>
                        <div class="mc-img">
                            <img src="mail-inbox.png" alt="" class="mailchimp">
                        </div>
                        <!-- below when we have metrics to display -->
                        <!-- <div  style="width: 30%; display: flex; flex-direction: row; gap: 20px;">
                            <div class="metric">

                                <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Total Emails Sent</p>
                                <h2 class="metric-value" id="metric-label-total"></h2>
                            </div>
                                                       <div class="metric">

                                <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Bounce Rate </p>
                                <h2 class="metric-value" id="metric-label-br"></h2>
                            </div>
                                                       <div class="metric">

                                <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Reply Rate</p>
                                <h2 class="metric-value" id="metric-label-rr"></h2>
                            </div>
                            
                            <div class="metric">
          
                                <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Plan</p>
                                <h2 class="metric-value" id="metric-label-plan"></h2>
                            </div>
                        </div> -->
                          
                    </div>
                </div>
                <link
                href="https://cdn.prod.website-files.com/670a6eaff9d5ba109641ceec/css/synetics-ultra-awesome-site.webflow.3b1f209ff.css"
                rel="stylesheet"
                type="text/css"
              />
              <script type="text/javascript">
                !(function (o, c) {
                  var n = c.documentElement,
                    t = " w-mod-";
                  (n.className += t + "js"),
                    ("ontouchstart" in o ||
                      (o.DocumentTouch && c instanceof DocumentTouch)) &&
                      (n.className += t + "touch");
                })(window, document);
              </script>
                <script
                src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=670a6eaff9d5ba109641ceec"
                type="text/javascript"
                integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
                crossorigin="anonymous"
              ></script>
              <script
                src="https://cdn.prod.website-files.com/670a6eaff9d5ba109641ceec/js/webflow.b41c76f6e.js"
                type="text/javascript"
              ></script>


            </div>


            <!-- <div class="pitch" style=" background: #ffffff;
            -webkit-box-shadow: 12px 12px 33px #cccccc, -12px -12px 33px #ffffff;
            box-shadow: 12px 12px 33px #cccccc, -12px -12px 33px #ffffff; display: flex; align-items: center; justify-content: start;">
            
            <h3 style="margin-top: 20px;">Your Progress</h3>
          
            <div>
                <h2>75%</h2>
            </div>
            <div style="width: 100%; height: 1px; background-color: #5e5e5e49;"></div>

            <div style="display: flex; flex-direction: row; align-items: center; justify-content: space-between; width: 90%;">
                <h3>Send your first Email</h3>
                <i class="fi fi-ss-hexagon-check" id="accountTick"></i>
            </div>

            </div> -->



            <!-- <div class="pitch" style="background: #ffffff; border-radius: 16px;
            -webkit-box-shadow: 12px 12px 33px #cccccc, -12px -12px 33px #ffffff;
            box-shadow: 12px 12px 33px #cccccc, -12px -12px 33px #ffffff;
            display: flex; flex-direction: column; align-items: center; padding: 20px;">
    
            <h3 style="margin-top: 20px;">Your Progress</h3>
          
            <div id="progress-circle" style="position: relative; width: 100px; height: 100px;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                    <h2 id="progress-percentage">0%</h2>
                </div>
            </div>
            <div style="width: 100%; height: 1px; background-color: #5e5e5e49; margin: 5px 0;"></div>
    
            <div class="task" data-task-id="1" >
                <h3 > Send your first Email</h3>
                <i class="fi fi-ss-hexagon" onclick="toggleDetailsx(this)" id="task-icon-1" style=" cursor: pointer; color: #5e5e5e;"></i>
            </div>
            
            <div class="task-details" data-task-id="1" style="display: none; width: 90%;">
                <button onclick="createCampaign()">Send Email</button>
            </div>
    
            <div class="task" data-task-id="2" style="display: flex; flex-direction: row; align-items: center; justify-content: space-between; width: 90%;">
                <h3>Create your first Campaign</h3>
                <i class="fi fi-ss-hexagon" onclick="toggleDetailsx(this)" id="task-icon-2"></i>
            </div>
            <div class="task-details" data-task-id="2" style="display: none; width: 90%;">
                <button onclick="createCampaign()">Create Campaign</button>
            </div>
    
            <div class="task" data-task-id="3" style="display: flex; flex-direction: row; align-items: center; justify-content: space-between; width: 90%;">
                <h3>Edit your Username</h3>
                <i class="fi fi-ss-hexagon" onclick="toggleDetailsx(this)" id="task-icon-3"></i>
            </div>
            <div class="task-details" data-task-id="3" style="display: none; width: 90%;">
                <button onclick="editUsername()">Edit Username</button>
            </div>
        </div> -->
    
          
        </div>
</div>


    <div  class="contentf" id="main-old"  style="display: none;">

        <div class="dashboard-usage">
            <div class="welcome-content-row">
            <div class="welcome">
              <p>Welcome </p>
              <h2 id="h2name"> HARRY</h2> 
              </div>
              </div>

            <div class="metrics">
                  <div class="metric">

                      <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Total Emails Used</p>
                      <!-- <h2 class="metric-value" id="metric-label-total">11 / 1000</h2> -->
                  </div>
                  <div class="metric">

                      <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Plan</p>
                      <!-- <h2 class="metric-value" id="metric-label-plan">Premium</h2> -->
                  </div>
                </div>
              <!-- </div>
              <div class="half">

              </div> -->

                
                <!-- <div class="metric">

                    <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Appointments</p>
                    <h2 class="metric-value">5</h2>
                </div>
                <div class="metric">
                    <p class="metric-label"><i class="fi fi-rr-credit-card"></i>Total Sales</p>
                    <h2 class="metric-value">$148.94</h2>
                </div> -->
            


            <!-- <div class="row-2"> -->
            <div class="plan-usage">
                <!-- <p class="plan-usage-detail" id="plan-usage-detail">{{ total_emails }} of {{plan_emails}} emails / mo</p> -->
                <div class="progress-text" id="progress-text">
                  <p>Current: 2</p>
                  <p>Total: 1000</p>
                </div>
                <div class="progress-bar">
                    <div id="progress" style="width: 57.3%;"></div>
                </div>
                <!-- <button class="button-man " id="subscription" >Upgrade</button> -->
                <button  id="subscription" >Upgrade</button>
            </div>
          </div>
  </div>



    <div   id="myAccount-content"  style="display: none;">

        <div class="ACC_dashboard-usage" style="overflow-y: scroll;">
            <!-- <h1>Dashboard</h1> -->
            <!-- <h4>A detailed overview of your metrics, usage, plan and more</h4> -->
            <div class="welcome-content-row">
            <div class="welcome">
              <!-- <p>Account Settings</p> -->
              <h1 style="color: black; font-size: 40px; margin-bottom: 10px; margin-left: 20px;">Account Settings</h1>
              <!-- <h2 id="h2name"> HARRY</h2>  -->
              </div>
              </div>
<!-- <div style="display: flex; width: 80%; flex-direction: row;  margin-block:10px ;  gap: 60px; padding: 20px;"> -->
    <div style="" class="cool-cont ">
        <h2 style="padding-left: 20px; padding-top: 20px;">Name</h2>
        <h4 style="padding-left: 20px;">This is the name your emails are sent from.</h4>
         <div class="coolinput" style="padding-left: 20px;">
            <input type="text" placeholder="Joe Smith" name="input" class="input" id="UPDATE_name">
        </div> 
        <h5 id="errorMessagename" style="padding-left: 10px;"></h5>
        <button class="button-man" onclick="updateNameForm()" style="margin-left: 20px;">Save</button>
        <br>
    </div>

    <div class="cool-cont">
    <!-- <br> -->
        <h2 style="padding-left: 20px; padding-top: 20px;">Email</h2>
        <h4 style="padding-left: 20px;">The email associated with your account.</h4>
        <div class="coolinput" style="padding-left: 20px;">
            <input type="text" placeholder="Name@email.com" name="input" class="input" id="emailinput">
        </div>     
        <h5 id="errorMessageemail" style="padding-left: 20px;"></h5>         
        <button class="button-man" style="padding-left: 20px;">Save</button>
        <br>
    </div>
<!-- </div> -->

<div class="cool-cont">
    <!-- <br> -->
              <h2 class="password-reset" style="margin: 20px; margin-top: 30px;">Reset Password</h2>
  
              <div class="coolinput" style="margin: 20px;">
                  <input type="text" placeholder="New Password" name="input" class="input" id="newPassword" >
              </div>
  
              <div class="coolinput" style="margin: 20px;">
                  <!-- <label for="input" class="text">Website:</label> -->
                  <input type="text" placeholder="Confirm Password" name="input" class="input" id="confirmPassword" >
              </div>
              <h5 id="errorMessage"></h5>
              <button class="button-man" style="margin: 20px;">Save</button>
              <br>
            </div>
        </div>
  </div>


    <div id="myAccount-content" style="display: none;" class="contentf">
        <div class="dashboard-usage">
            <h1>Your Account</h1>
            <h4>A detailed overview of your metrics, usage, plan and more</h4>
            <h2>Name</h2>
            <h4>This is the name your emails are sent from.</h4>
            <div class="coolinput">
                <!-- <label for="input" class="text">Name:</label> -->
                <input type="text" placeholder="Joe Smith" name="input" class="input" id="UPDATE_name">
            </div>
            <h5 id="errorMessagename"></h5>
            <button id="subscription" onclick="updateNameForm()">Save</button>
            
            <h2>Email</h2>
            <h4>The Email associated with your account, not necessarily the email used to send your emails.</h4>
            <div class="coolinput">
                <!-- <label for="input" class="text">Email:</label> -->
                <input type="text" placeholder="Name@email.com" name="input" class="input" id="emailinput">
                <!-- <input placeholder="Email address" class="input" name="text" type="email" placeholder="CoolGuy1@email.com"/> -->
            </div>     
            <h5 id="errorMessageemail"></h5>         
            <button id="subscription">Save</button>
            <h2 class="password-reset">Reset Password</h2>

            <div class="coolinput">
                <input type="text" placeholder="New Password" name="input" class="input" id="newPassword" >
            </div>

            <div class="coolinput">
                <!-- <label for="input" class="text">Website:</label> -->
                <input type="text" placeholder="Confirm Password" name="input" class="input" id="confirmPassword" >
            </div>
            <h5 id="errorMessage"></h5>
            <button id="subscription">Save</button>
          </div>
  </div>

    <div id="notification-container-pop"></div>
    <script>
        document.getElementById('fileInput').addEventListener('change', handleFile, false);
        // document.getElementById('fileMIDDLE').addEventListener('change', handleFile, false);

        document.getElementById('emailForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            let domain = document.getElementById('domain').value;
            let newDomain = domain
            if (!/^https:\/\//i.test(domain)) {
                 newDomain = 'https://' + domain;
            }
            domain = domain.replace(/^https?:\/\//, '');

            try {
                const response = await fetch(`https://server.voltmailer.com/get-emails?domain=${encodeURIComponent(domain)}`);
                const data = await response.json();
                
                if (data.data && data.data.emails) {
                    const emails = data.data.emails;
                    if (emails.length > 0){
                    emails.forEach(item => {

                        const formData = {
                            email: item.value,
                            website: newDomain,
                            name: item.first_name || '' // Fallback in case first_name is not provided
                        };
                        submittedData.push(formData);
                    });
                    document.getElementById('manual-popup-overlay-domain').style.display = 'none';
                    updateTable()
                    console.log("found")
                }
                else
                {
                    document.getElementById('results').textContent = 'No emails found or an error occurred.'; 
                }
                } else {
                    document.getElementById('results').textContent = 'No emails found or an error occurred.';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('results').textContent = 'An error occurred while fetching emails.';
            }
        });
        // Function to handle tab switching

        function OpenAccount() {
            // Example logic for createCampaign
            console.log('Creating campaign...');
            // Simulate a click on the 'Usage' tab (id 2)
            const usageTab = document.getElementById('4');
            usageTab.click();
        }
        function createCampaign() {
            // Example logic for createCampaign
            console.log('Creating campaign...');
            // Simulate a click on the 'Usage' tab (id 2)
            const usageTab = document.getElementById('2');
            usageTab.click();
        }
        function GoHome() {
            // Example logic for createCampaign
            // console.log('Creating campaign...');
            // Simulate a click on the 'Usage' tab (id 2)
            const usageTab = document.getElementById('1');
            usageTab.click();
        }
        


        function switchTab(event) {
            // Remove active class from all menu items
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));

            // Add active class to the clicked menu item
            event.currentTarget.classList.add('active');

            // Get the content div
            // const contentDiv = document.querySelector('.content');


            // Clear current content
            // contentDiv.innerHTML = '';

            // Get the id of the clicked menu item
            const id = event.currentTarget.id;
            console.log(id)

            // Switch content based on the clicked menu item
            switch (id) {
                case '1':
                    console.log('1')
                    document.getElementById('myAccount-content').style.display = 'none';
                    document.getElementById('myUsage-content').style.display = 'none';
                    document.getElementById('main').style.display = 'block';
                    // document.getElementById('maintop').style.display = 'flex';
                    contentDiv.innerHTML = '<h2>Home Content</h2><p>This is the home page content.</p>';
                    break;
                case '2':
                console.log('2')  
                    document.getElementById('myUsage-content').style.display = 'flex';
                    document.getElementById('myAccount-content').style.display = 'none';
                    document.getElementById('main').style.display = 'none';
                    // document.getElementById('maintop').style.display = 'none';
                    contentDiv.innerHTML = '<h2>Usage Content</h2><p>This is the usage page content.</p>';
                    break;
                case '3':
                    contentDiv.innerHTML = '<h2>Billing Content</h2><p>This is the billing page content.</p>';
                    break;
                case '4':
                    document.getElementById('myAccount-content').style.display = 'flex'; 
                    document.getElementById('myUsage-content').style.display = 'none';
                    document.getElementById('main').style.display = 'none';
                    // document.getElementById('maintop').style.display = 'none';
                    contentDiv.innerHTML = '<h2>Account Content</h2><p>This is the account page content.</p>';
                    break;
                case '5':
                    // contentDiv.innerHTML = '<h2>Help Content</h2><p>This is the help page content.</p>';
                    document.getElementById('template').style.display = 'flex'; 
                    document.getElementById('myAccount-content').style.display = 'none'; 
                    document.getElementById('myUsage-content').style.display = 'none';
                    document.getElementById('main').style.display = 'none';
                    break;
                default:
                    contentDiv.innerHTML = '<h2>Home Content</h2><p>This is the default home page content.</p>';
            }
        }

        // Attach event listeners to menu items
        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => {
            item.addEventListener('click', switchTab);
        });

        // const menuToggle = document.getElementById('mobile-menu');
        // const navLinks = document.querySelector('.nav-links');

        // menuToggle.addEventListener('click', () => {
        //     menuToggle.classList.toggle('active');
        //     navLinks.classList.toggle('active');
        // });




    async function updateNameForm(){

        console.log("name", U_MyEmail)
    const name = document.getElementById('UPDATE_name').value;
    console.log(name, U_MyEmail)
    // const email = prompt('Please enter your email to update your name:');
    const errorMessages = document.getElementById('errorMessagename');

    errorMessages.innerHTML = '';

    try {
        const response = await fetch('https://server.voltmailer.com/update-customer-by-email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: U_MyEmail,
                updateField: 'name',
                newData: name
            }),
        });

        const data = await response.json();
        
        if (response.ok) {
            errorMessages.innerHTML = `<p>${data.message}</p>`;
            init()
        } else {
            errorMessages.innerHTML = `<p>Error: ${data.message}</p>`;
        }
    } catch (error) {
        console.error('Error:', error);
        errorMessages.innerHTML = '<p>An error occurred while updating the name.</p>';
    }
};

async function updateEmailForm(){
    console.log("email")
    const name = document.getElementById('emailinput').value;
    // const email = prompt('Please enter your email to update your name:');
    const errorMessages = document.getElementById('errorMessageemail');

    errorMessages.innerHTML = '';

    try {
        const response = await fetch('https://server.voltmailer.com/update-customer-by-email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: U_MyEmail,
                updateField: 'email',
                newData: name
            }),
        });

        const data = await response.json();
        
        if (response.ok) {
            errorMessages.innerHTML = `<p>${data.message}</p>`;
            init()
        } else {
            errorMessages.innerHTML = `<p>Error: ${data.message}</p>`;
        }
    } catch (error) {
        console.error('Error:', error);
        errorMessages.innerHTML = '<p>An error occurred while updating the name.</p>';
    }
};
    async function updatePasswordForm() {
        console.log("password")
    const password = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    // const email = prompt('Please enter your email to update your password:');
    const errorMessages = document.getElementById('errorMessages');

    errorMessages.innerHTML = '';

    if (password !== confirmPassword) {
        errorMessages.innerHTML += '<p>Passwords do not match.</p>';
        return;
    }

    if (password.length <= 5) {
        errorMessages.innerHTML += '<p>Password must be longer than 5 characters.</p>';
        return;
    }

    if (!/[A-Z]/.test(password)) {
        errorMessages.innerHTML += '<p>Password must contain at least one uppercase letter.</p>';
        return;
    }

    if (!/\d/.test(password)) {
        errorMessages.innerHTML += '<p>Password must contain at least one number.</p>';
        return;
    }

    try {
        const response = await fetch('https://server.voltmailer.com/update-customer-by-email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: U_MyEmail,
                updateField: 'password',
                newData: password
            }),
        });

        const data = await response.json();
        
        if (response.ok) {
            errorMessages.innerHTML = `<p>${data.message}</p>`;
            init()
        } else {
            errorMessages.innerHTML = `<p>Error: ${data.message}</p>`;
        }
    } catch (error) {
        console.error('Error:', error);
        errorMessages.innerHTML = '<p>An error occurred while updating the password.</p>';
    }
};


    </script>
</body>
</html>
