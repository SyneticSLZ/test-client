<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Sent Emails Dashboard</title>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 max-w-5xl">
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <!-- Header Section -->
            <div class="bg-purple-600 text-white p-6 flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold">Sent Emails</h1>
                    <div class="flex space-x-4 mt-2">
                        <div class="bg-purple-500 rounded-md p-2 text-center">
                            <span class="block text-sm font-medium">Total Emails</span>
                            <span id="totalEmailsMetric" class="text-xl font-bold">0</span>
                        </div>
                        <div class="bg-purple-500 rounded-md p-2 text-center">
                            <span class="block text-sm font-medium">Delivered</span>
                            <span id="deliveredEmailsMetric" class="text-xl font-bold">0</span>
                        </div>
                        <div class="bg-purple-500 rounded-md p-2 text-center">
                            <span class="block text-sm font-medium">Opened</span>
                            <span id="openedEmailsMetric" class="text-xl font-bold">0</span>
                        </div>
                        <div class="bg-purple-500 rounded-md p-2 text-center">
                            <span class="block text-sm font-medium">Replied</span>
                            <span id="repliedEmailsMetric" class="text-xl font-bold">0</span>
                        </div>
                        <div class="bg-purple-500 rounded-md p-2 text-center">
                            <span class="block text-sm font-medium">Bounced</span>
                            <span id="bouncedEmailsMetric" class="text-xl font-bold">0</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="exportSelectedBtn" class="bg-white/20 hover:bg-white/30 transition-colors duration-300 p-2 rounded-md text-sm font-medium">
                        Export Selected
                    </button>
                    <button id="refreshEmailsBtn" class="bg-white/20 hover:bg-white/30 transition-colors duration-300 p-2 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Email Search and Filter -->
            <div class="p-4 bg-gray-100 flex items-center space-x-4">
                <input 
                    type="text" 
                    id="emailSearchInput" 
                    placeholder="Search emails..." 
                    class="flex-grow p-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 transition-all"
                />
                <select 
                    id="emailFilterSelect" 
                    class="p-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500"
                >
                    <option value="all">All Emails</option>
                    <option value="delivered">Delivered</option>
                    <option value="opened">Opened</option>
                    <option value="replied">Replied</option>
                    <option value="bounced">Bounced</option>
                </select>
                <select 
                    id="emailSortSelect" 
                    class="p-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500"
                >
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                </select>
            </div>

            <!-- Emails Container -->
            <div id="sentEmailsContainer" class="divide-y divide-gray-200">
                <!-- Emails will be dynamically inserted here -->
            </div>
        </div>

        <!-- Reply Modal -->
        <div id="replyModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Reply to Email</h2>
                    <button id="closeReplyModalBtn" class="text-gray-500 hover:text-gray-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div id="replyModalContent" class="mb-4">
                    <!-- Original email details will be populated here -->
                </div>
                <textarea 
                    id="replyTextArea" 
                    class="w-full h-40 p-2 border rounded-md focus:ring-2 focus:ring-purple-500" 
                    placeholder="Write your reply..."
                ></textarea>
                <div class="flex justify-end space-x-3 mt-4">
                    <button id="cancelReplyBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                        Cancel
                    </button>
                    <button id="sendReplyBtn" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">
                        Send Reply
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>

        
        class SentEmailsManager {
            constructor(containerElement, emails) {
                this.container = containerElement;
                this.emails = emails.map(email => ({
                    ...email,
                    status: this.generateRandomStatus()
                }));
                this.filteredEmails = this.emails;
                this.selectedEmails = new Set();
                this.initializeEventListeners();
                this.render();
                this.updateMetrics();
            }

            generateRandomStatus() {
                const statuses = ['delivered', 'opened', 'replied', 'bounced'];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                return {
                    delivered: Math.random() > 0.1,
                    opened: Math.random() > 0.3,
                    replied: Math.random() > 0.5,
                    bounced: Math.random() < 0.1,
                    primaryStatus: randomStatus
                };
            }

            initializeEventListeners() {
                // Search input listener
                const searchInput = document.getElementById('emailSearchInput');
                searchInput.addEventListener('input', () => this.filterEmails(searchInput.value));

                // Filter select listener
                const filterSelect = document.getElementById('emailFilterSelect');
                filterSelect.addEventListener('change', () => this.filterEmailsByStatus(filterSelect.value));

                // Sort select listener
                const sortSelect = document.getElementById('emailSortSelect');
                sortSelect.addEventListener('change', () => this.sortEmails(sortSelect.value));

                // Refresh button listener
                const refreshBtn = document.getElementById('refreshEmailsBtn');
                refreshBtn.addEventListener('click', () => this.refreshEmails());

                // Export selected emails listener
                const exportBtn = document.getElementById('exportSelectedBtn');
                exportBtn.addEventListener('click', () => this.exportSelectedEmails());

                // Reply modal listeners
                this.setupReplyModalListeners();
            }

            setupReplyModalListeners() {
                const replyModal = document.getElementById('replyModal');
                const closeModalBtn = document.getElementById('closeReplyModalBtn');
                const cancelReplyBtn = document.getElementById('cancelReplyBtn');
                const sendReplyBtn = document.getElementById('sendReplyBtn');

                closeModalBtn.addEventListener('click', () => this.toggleReplyModal());
                cancelReplyBtn.addEventListener('click', () => this.toggleReplyModal());
                sendReplyBtn.addEventListener('click', () => this.sendReply());
            }

            toggleReplyModal(email = null) {
                const replyModal = document.getElementById('replyModal');
                const modalContent = document.getElementById('replyModalContent');
                const replyTextArea = document.getElementById('replyTextArea');

                replyModal.classList.toggle('hidden');
                replyModal.classList.toggle('flex');

                if (email) {
                    modalContent.innerHTML = `
                        <div class="bg-gray-100 p-4 rounded-md mb-4">
                            <div class="font-bold text-purple-600">To: ${email.recipient}</div>
                            <div class="text-gray-700">Subject: Re: ${email.subject}</div>
                            <div class="text-gray-600 mt-2">${email.body}</div>
                        </div>
                    `;
                    replyTextArea.value = '';
                    replyTextArea.dataset.emailId = email.id;
                }
            }

            sendReply() {
                const replyTextArea = document.getElementById('replyTextArea');
                const replyText = replyTextArea.value.trim();
                const originalEmailId = replyTextArea.dataset.emailId;

                if (replyText) {
                    // In a real app, this would send the reply via backend
                    console.log('Sending reply:', {
                        originalEmailId,
                        replyText
                    });

                    // Update email status to replied
                    const emailToUpdate = this.emails.find(email => email.id === originalEmailId);
                    if (emailToUpdate) {
                        emailToUpdate.status.replied = true;
                        emailToUpdate.status.primaryStatus = 'replied';
                    }

                    this.toggleReplyModal();
                    this.render();
                    this.updateMetrics();
                }
            }

            render() {
                this.container.innerHTML = '';
                this.filteredEmails.forEach(email => {
                    const emailRow = this.createEmailRow(email);
                    this.container.insertAdjacentHTML('beforeend', emailRow);
                });
            }

            filterEmails(searchTerm) {
                this.filteredEmails = this.emails.filter(email => 
                    email.recipient.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    email.subject.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    email.body.toLowerCase().includes(searchTerm.toLowerCase())
                );
                this.render();
            }

            filterEmailsByStatus(status) {
                if (status === 'all') {
                    this.filteredEmails = this.emails;
                } else {
                    this.filteredEmails = this.emails.filter(email => 
                        email.status[status]
                    );
                }
                this.render();
            }

            sortEmails(sortType) {
                this.filteredEmails.sort((a, b) => {
                    const dateA = new Date(a.date);
                    const dateB = new Date(b.date);
                    return sortType === 'newest' ? dateB - dateA : dateA - dateB;
                });
                this.render();
            }

            updateMetrics() {
                const totalEmails = this.emails.length;
                const deliveredEmails = this.emails.filter(email => email.status.delivered).length;
                const openedEmails = this.emails.filter(email => email.status.opened).length;
                const repliedEmails = this.emails.filter(email => email.status.replied).length;
                const bouncedEmails = this.emails.filter(email => email.status.bounced).length;

                document.getElementById('totalEmailsMetric').textContent = totalEmails;
                document.getElementById('deliveredEmailsMetric').textContent = deliveredEmails;
                document.getElementById('openedEmailsMetric').textContent = openedEmails;
                document.getElementById('repliedEmailsMetric').textContent = repliedEmails;
                document.getElementById('bouncedEmailsMetric').textContent = bouncedEmails;
            }

            createEmailRow(email) {
                // Status color mapping
                const statusColors = {
                    delivered: 'text-green-600',
                    opened: 'text-blue-600',
                    replied: 'text-purple-600',
                    bounced: 'text-red-600'
                };

                return `
                    <div class="email-row hover:bg-purple-50 transition-colors duration-200 flex items-center" data-email-id="${email.id}">
                        <div class="p-2">
                            <input 
                                type="checkbox" 
                                class="email-checkbox form-checkbox h-5 w-5 text-purple-600 rounded"
                                onclick="sentEmailsManager.toggleEmailSelection('${email.id}')"
                            >
                        </div>
                        <div class="flex-grow cursor-pointer" onclick="toggleEmailDetails('${email.id}')">
                            <div class="flex items-center justify-between p-4">
                                <div class="flex-grow">
                                    <div class="flex items-center space-x-3">
                                        <span class="font-medium text-gray-800 truncate max-w-md">
                                            <span class="text-purple-600">${email.recipient}</span> 
                                            - ${email.subject}
                                        </span>
                                        <span class="text-sm ${statusColors[email.status.primaryStatus]} font-medium">
                                            ${email.status.primaryStatus.charAt(0).toUpperCase() + email.status.primaryStatus.slice(1)}
                                        </span>
                                        <span class="text-sm text-gray-500">${email.date}</span>
                                        <span class="ml-2 text-gray-500 text-sm">(click to expand)</span>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button 
                                        onclick="sentEmailsManager.openReplyModal('${email.id}')" 
                                        class="text-purple-600 hover:text-purple-800 focus:outline-none"
                                    >
                                        <svg xmlns="http://www.w3.org/22000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </div>
                            </div>
                            <div id="email-details-${email.id}" class="hidden p-4 bg-gray-50 text-sm text-gray-700">
                                ${email.body}
                            </div>
                        </div>
                    </div>
                `;
            }

            openReplyModal(emailId) {
                const email = this.emails.find(e => e.id === emailId);
                if (email) {
                    this.toggleReplyModal(email);
                }
            }

            toggleEmailDetails(emailId) {
                const detailsElement = document.getElementById(`email-details-${emailId}`);
                detailsElement.classList.toggle('hidden');
            }

            toggleEmailSelection(emailId) {
                const checkbox = document.querySelector(`[data-email-id="${emailId}"] .email-checkbox`);
                if (checkbox.checked) {
                    this.selectedEmails.add(emailId);
                } else {
                    this.selectedEmails.delete(emailId);
                }
            }

            exportSelectedEmails() {
                const selectedEmailsData = this.emails.filter(email => 
                    this.selectedEmails.has(email.id)
                );
                console.log('Exporting selected emails:', selectedEmailsData);
                // In a real app, implement actual export functionality
            }

            refreshEmails() {
                // Simulate fetching new emails
                this.emails = this.emails.map(email => ({
                    ...email,
                    status: this.generateRandomStatus()
                }));
                this.filteredEmails = this.emails;
                this.render();
                this.updateMetrics();
            }

            render() {
                this.container.innerHTML = this.filteredEmails
                    .map(email => this.createEmailRow(email))
                    .join('');
            }
        }

        // Sample emails data
        const sampleEmails = [
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15',
            },
            {
                id: 'email341',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'emailfesfd1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'emaiwerwel1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'emewrwerwail1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: '3',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            ,
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            },
            {
                id: 'email1',
                recipient: 'john.doe@example.com',
                subject: 'Project Update',
                body: 'Here is the latest update on our ongoing project...',
                date: '2024-02-15'
            }
            
            
            // Add more sample emails here...
        ];

        // Initialize the emails dashboard
        const sentEmailsContainer = document.getElementById('sentEmailsContainer');
        const sentEmailsManager = new SentEmailsManager(sentEmailsContainer, sampleEmails);

        // Global functions to interface with the class methods
        window.toggleEmailDetails = (emailId) => sentEmailsManager.toggleEmailDetails(emailId);
    </script>
</body>
</html>