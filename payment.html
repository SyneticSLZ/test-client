<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment | VoltMailer</title>
    <link rel="icon" href="favicon.png" type="image/icon type">
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.2/uicons-solid-straight/css/uicons-solid-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.2/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.2/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.2/uicons-bold-rounded/css/uicons-bold-rounded.css'>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f7ff;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: start;
            padding: 20px;
        }
        #checkout{
            width: 100%;
        }
        .nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
        }
        .nav img {
            height: 100px;
            width: 170px;
        }
        .content {
            width: 55%;
            /* max-width: 800px; */
            /* background: white; */
            /* padding: 20px; */
            /* box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); */
            border-radius: 8px;
            box-sizing: border-box;
        }
         .headerrow{
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
    
        } 
        .full {
            border: 2px solid #1b1b1b;
            border-radius: 10px;
            width: 100%;
            margin-block: 20px;
        }
        h2 {
            margin-left: 20px;
            font-size: 32px;
            margin-top: 30px;
            margin-bottom: 30px;
        }
        #accountTick{
            margin-right: 20px;
            font-size: 40px;
            color: purple;
            display: none;
        }
        #down {
            margin-right: 20px;
            font-size: 40px;
        }
        p {
            font-size: 18px;
            font-weight: 400;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
            width: 100%;
            /* border: 2px solid #b40000; */
            /* border-radius: 10px; */
        }
        .social-login {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-left: 20px;
            margin-bottom: 20px;
            /* width: 40%; */
        }
        .social-login button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .google {
            background-color: white;
            color: #5a5a5a;
            border: 1px solid #ccc;
        }
        .google img {
            margin-right: 8px;
        }
        .facebook {
            background-color: #1877f2;
            color: white;
        }
        .separator {
            text-align: center;
            margin-inline: 10px;
            width: 10%;
            position: relative;
            flex-direction: column;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }
        .separator span {
            display: inline-block;
            background: #f5f7ff;
            padding: 0 10px;
            position: relative;
            z-index: 1;
        }
        /* .separator::before {
            content: '';
            display: block;
            height: 100%;
            width: 1px;
            background: #740000;
            position: absolute;
            top: 50%;
            left: 0;
            z-index: 0;
        } */
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 45%;
        }
        .login-form input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            width: 80%;
        }
        .login-form .input-group {
            position: relative;
        }
        .login-form .input-group img {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
    
        .login-form-name {
            display: flex;
            flex-direction: row;
            margin-left: 20px;
            margin-bottom: 20px;
            gap: 10px;
            width: 85%;
            /* border: #00ddeb 1px solid; */
            align-items: center;
            justify-content: start;
        }
        .login-form-name input  {
            padding: 10px ;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
            width: 80%;
        }
         .login-form-name button{
            width: 100%;
            padding: 10px ;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0;
         }
        .login-form-name .input-group {
            position: relative;
            /* justify-self: center; */
            /* align-self: center; */
        }
        .login-form-name .input-group img {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        .account-link {
            text-align: start;
            margin-top: 10px;
        }
        .account-link a {
            color: #3b49df;
            text-decoration: none;
        }
        @media (min-width: 768px) {
            .container {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            .separator {
                margin: 0 20px;
            }
        }
        #loadingbody {
                font-family: 'Arial', sans-serif;
                /* background-color: #02021E; */
                color: #fff;
                margin: 0;
                padding: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100%;
                width: 100%;
            }
    
            #loading {
                /* max-width: 800px; */
                /* padding: 20px; */
                background-color: rgba(0, 0, 0, 0);
                border-radius: 10px;
                text-align: center;
                width: 100%;
                margin-top: 30px;
                /* box-sizing: border-box; */
                /* border: #00ddeb 2px solid; */
                display: flex;
                align-items: center;justify-content: center;
            }
        .title {
                font-size: 2.5em;
                margin-bottom: 10px;
                background: linear-gradient(to bottom, #f0f, #0ff);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                color: transparent;
            }
    
            .subtitle {
                font-size: 1.2em;
                margin-bottom: 30px;
                color: #181818;
            }
    
            .hidden {
                display: none;
            }
    
            .active {
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
            }
    
            .loader {
                padding: 0;
                margin: 0;
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 150px;
                height: 150px;
                margin: 30px 0;
                perspective: 780px;
            }
    
            .text {
                font-size: 20px;
                font-weight: 700;
                /* color: #cecece; */
                color: #1818189a;
                z-index: 10;
            }
    
            .load-inner {
                position: absolute;
                width: 100%;
                height: 100%;
                box-sizing: border-box;
                border-radius: 50%;
            }
    
            .load-inner.load-one {
                left: 0%;
                top: 0%;
                border-bottom: 3px solid #5c5edc;
                animation: rotate1 1.15s linear infinite;
            }
    
            .load-inner.load-two {
                right: 0%;
                top: 0%;
                border-right: 3px solid #9147ff;
                animation: rotate2 1.15s 0.1s linear infinite;
            }
    
            .load-inner.load-three {
                right: 0%;
                bottom: 0%;
                border-top: 3px solid #3b82f6;
                animation: rotate3 1.15s 0.15s linear infinite;
            }
    
            @keyframes rotate1 {
                0% { transform: rotateX(45deg) rotateY(-45deg) rotateZ(0deg); }
                100% { transform: rotateX(45deg) rotateY(-45deg) rotateZ(360deg); }
            }
    
            @keyframes rotate2 {
                0% { transform: rotateX(45deg) rotateY(45deg) rotateZ(0deg); }
                100% { transform: rotateX(45deg) rotateY(45deg) rotateZ(360deg); }
            }
    
            @keyframes rotate3 {
                0% { transform: rotateX(-60deg) rotateY(0deg) rotateZ(0deg); }
                100% { transform: rotateX(-60deg) rotateY(0deg) rotateZ(360deg); }
            }
    
            @media (max-width: 600px) {
                .title {
                    font-size: 2em;
                }
    
                .subtitle {
                    font-size: 1em;
                }
            }
    
            input[type="text"] {
                padding: 10px;
                margin: 20px 0;
                font-size: 1em;
                border: none;
                border-radius: 5px;
                width: 80%;
                box-sizing: border-box;
            }
    
            button {
                padding: 10px 20px;
                font-size: 1em;
                color: #fff;
                background-color: #ff6f61;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                margin-top: 20px;
            }
    
            button:hover {
                background-color: #e55a50;
            }
    
            .retry-link {
                color: #ff6f61;
                text-decoration: none;
            }
    
            .retry-link:hover {
                text-decoration: underline;
            }
            .login {
      /* width: 340px; */
      /* height: 400px; */
      /* background: #2c2c2c; */
      padding: 47px;
      padding-bottom: 57px;
      color: #fff;
      border-radius: 17px;
      padding-bottom: 50px;
      font-size: 1.3em;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    .login input[type="text"],
    .login input[type="password"] {
      opacity: 1;
      display: block;
      border: none;
      outline: none;
      width: 100%;
      padding: 13px 18px;
      margin: 20px 0 0 0;
      font-size: 0.8em;
      border-radius: 100px;
      background: #131212;
      color: #fff;
    }
    
    .login input:focus {
      animation: bounce 1s;
      -webkit-appearance: none;
    }
    .login h1{
        /* font-size: 60px; */
    }
    .login input[type=submit],
    .login input[type=button],
    .h1 {
      border: 0;
      outline: 0;
      width: 100%;
      padding: 13px;
      margin: 40px 0 0 0;
      border-radius: 500px;
      font-weight: 600;
      animation: bounce2 1.6s;
    
    }
    
    .h1 {
      padding: 0;
      position: relative;
      top: -35px;
      display: block;
      margin-bottom: -0px;
      font-size: 1.3em;
    }
    
    .btn {
      background: linear-gradient(144deg, #af40ff, #5b42f3 50%, #00ddeb);
      color: #fff;
      padding: 16px !important;
    }
    
    .btn:hover {
        background: linear-gradient(144deg, #af40ffc8, #5b42f3c8 50%, #00ddebc8);
      color: rgb(255, 255, 255);
      padding: 16px !important;
      cursor: pointer;
      transition: all 0.4s ease;
    }
    
    .login input[type=text] {
      animation: bounce 1s;
      -webkit-appearance: none;
      margin-top: 2em;
    }
    
    .login input[type=password] {
      animation: bounce1 1.3s;
    }
    
    .ui {
      font-weight: bolder;
      background: -webkit-linear-gradient(#B563FF, #535EFC, #0EC8EE);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      border-bottom: 4px solid transparent;
      border-image: linear-gradient(0.25turn, #535EFC, #0EC8EE, #0EC8EE);
      border-image-slice: 1;
      display: inline;
    }
    
    @media only screen and (max-width: 600px) {
      .login {
        width: 70%;
        padding: 3em;
      }
    }
    
    @keyframes bounce {
      0% {
        transform: translateY(-250px);
        opacity: 0;
      }
    }
    
    @keyframes bounce1 {
      0% {
        opacity: 0;
      }
    
      40% {
        transform: translateY(-100px);
        opacity: 0;
      }
    }
    
    @keyframes bounce2 {
      0% {
        opacity: 0;
      }
    
      70% {
        transform: translateY(-20px);
        opacity: 0;
      }
    }
    </style>
</head>
<body>

    <div class="nav">
        <img src="vmb.png" alt="VoltMailer Logo">
        <!-- <a href="#">Log In</a> -->
    </div>
<div id="loadingbody">
    <div class="container"  id="loading" style="display: none;">
        <div id="processing" class="active">
            <h1 class="title">Processing Payment</h1>
            <div class="loader">
                <div class="load-inner load-one"></div>
                <div class="load-inner load-two"></div>
                <div class="load-inner load-three"></div>
                <!-- <span class="text">Loading...</span> -->
            </div>
        </div>
        <!-- <div id="success" class="hidden">
            <div class="login wrap">
                <h1 class="title">Payment Success</h1>
              </div>
        </div> -->
        <div id="failure" class="hidden">
            <h1 class="title">Payment Failed</h1>
            <p class="subtitle">Unfortunately, your payment could not be processed. Please try again or <a class="retry-link" onclick="failedCheckout()">return to checkout</a>.</p>
        </div>

        <div id="success" class="hidden">
            <h1 class="title">Welcome to the Future of Email Automation</h1>
            <div class="loader">
                <div class="load-inner load-one"></div>
                <div class="load-inner load-two"></div>
                <div class="load-inner load-three"></div>
                <span class="text">Setting up your account...</span>
            </div>
        </div>

        <!-- <style>
            body {
                font-family: 'Arial', sans-serif;
                background-color: #02021E;
                color: #fff;
                margin: 0;
                padding: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
            }
    
            .container {
                max-width: 800px;
                padding: 20px;
                background: rgba(0, 0, 0, 0);
                border-radius: 10px;
                text-align: center;
                width: 90%;
                box-sizing: border-box;
            }
    
            .title {
                font-size: 2.5em;
                margin-bottom: 10px;
                background: linear-gradient(to bottom, #f0f, #0ff);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                color: transparent;
            }
    
            .subtitle {
                font-size: 1.2em;
                margin-bottom: 30px;
                color: #ddd;
            }
    
            .hidden {
                display: none;
            }
    
            .active {
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
            }
    
            .loader {
                padding: 0;
                margin: 0;
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 150px;
                height: 150px;
                margin: 30px 0;
                perspective: 780px;
            }
    
            .text {
                font-size: 20px;
                font-weight: 700;
                color: #cecece;
                z-index: 10;
            }
    
            .load-inner {
                position: absolute;
                width: 100%;
                height: 100%;
                box-sizing: border-box;
                border-radius: 50%;
            }
    
            .load-inner.load-one {
                left: 0%;
                top: 0%;
                border-bottom: 3px solid #5c5edc;
                animation: rotate1 1.15s linear infinite;
            }
    
            .load-inner.load-two {
                right: 0%;
                top: 0%;
                border-right: 3px solid #9147ff;
                animation: rotate2 1.15s 0.1s linear infinite;
            }
    
            .load-inner.load-three {
                right: 0%;
                bottom: 0%;
                border-top: 3px solid #3b82f6;
                animation: rotate3 1.15s 0.15s linear infinite;
            }
    
            @keyframes rotate1 {
                0% { transform: rotateX(45deg) rotateY(-45deg) rotateZ(0deg); }
                100% { transform: rotateX(45deg) rotateY(-45deg) rotateZ(360deg); }
            }
    
            @keyframes rotate2 {
                0% { transform: rotateX(45deg) rotateY(45deg) rotateZ(0deg); }
                100% { transform: rotateX(45deg) rotateY(45deg) rotateZ(360deg); }
            }
    
            @keyframes rotate3 {
                0% { transform: rotateX(-60deg) rotateY(0deg) rotateZ(0deg); }
                100% { transform: rotateX(-60deg) rotateY(0deg) rotateZ(360deg); }
            }
    
            @media (max-width: 600px) {
                .title {
                    font-size: 2em;
                }
    
                .subtitle {
                    font-size: 1em;
                }
            }
    
            input[type="text"] {
                padding: 10px;
                margin: 20px 0;
                font-size: 1em;
                border: none;
                border-radius: 5px;
                width: 80%;
                box-sizing: border-box;
            }
    
            button {
                padding: 10px 20px;
                font-size: 1em;
                color: #fff;
                background-color: #ff6f61;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                margin-top: 20px;
            }
    
            button:hover {
                background-color: #e55a50;
            }
    
            .retry-link {
                color: #ff6f61;
                text-decoration: none;
            }
    
            .retry-link:hover {
                text-decoration: underline;
            }
            .login {
      /* width: 340px; */
      /* height: 400px; */
      /* background: #2c2c2c; */
      padding: 47px;
      padding-bottom: 57px;
      color: #fff;
      border-radius: 17px;
      padding-bottom: 50px;
      font-size: 1.3em;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    .login input[type="text"],
    .login input[type="password"] {
      opacity: 1;
      display: block;
      border: none;
      outline: none;
      width: 100%;
      padding: 13px 18px;
      margin: 20px 0 0 0;
      font-size: 0.8em;
      border-radius: 100px;
      background: #131212;
      color: #fff;
    }
    
    .login input:focus {
      animation: bounce 1s;
      -webkit-appearance: none;
    }
    .login h1{
        /* font-size: 60px; */
    }
    .login input[type=submit],
    .login input[type=button],
    .h1 {
      border: 0;
      outline: 0;
      width: 100%;
      padding: 13px;
      margin: 40px 0 0 0;
      border-radius: 500px;
      font-weight: 600;
      animation: bounce2 1.6s;
    
    }
    
    .h1 {
      padding: 0;
      position: relative;
      top: -35px;
      display: block;
      margin-bottom: -0px;
      font-size: 1.3em;
    }
    
    .btn {
      background: linear-gradient(144deg, #af40ff, #5b42f3 50%, #00ddeb);
      color: #fff;
      padding: 16px !important;
    }
    
    .btn:hover {
        background: linear-gradient(144deg, #af40ffc8, #5b42f3c8 50%, #00ddebc8);
      color: rgb(255, 255, 255);
      padding: 16px !important;
      cursor: pointer;
      transition: all 0.4s ease;
    }
    
    .login input[type=text] {
      animation: bounce 1s;
      -webkit-appearance: none;
      margin-top: 2em;
    }
    
    .login input[type=password] {
      animation: bounce1 1.3s;
    }
    
    .ui {
      font-weight: bolder;
      background: -webkit-linear-gradient(#B563FF, #535EFC, #0EC8EE);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      border-bottom: 4px solid transparent;
      border-image: linear-gradient(0.25turn, #535EFC, #0EC8EE, #0EC8EE);
      border-image-slice: 1;
      display: inline;
    }
    
    @media only screen and (max-width: 600px) {
      .login {
        width: 70%;
        padding: 3em;
      }
    }
    
    @keyframes bounce {
      0% {
        transform: translateY(-250px);
        opacity: 0;
      }
    }
    
    @keyframes bounce1 {
      0% {
        opacity: 0;
      }
    
      40% {
        transform: translateY(-100px);
        opacity: 0;
      }
    }
    
    @keyframes bounce2 {
      0% {
        opacity: 0;
      }
    
      70% {
        transform: translateY(-20px);
        opacity: 0;
      }
    }
        </style> -->

    </div>
</div>


    <div class="content" id="above-checkout">
        <h2>Youâ€™re almost there! Complete your order</h2>
        <p id="selected-plan">Selected Plan:  <b>Premium</b></p>

    <div class="full" id="full-Account">
<div class="headerrow" id="Account">
    <h2>1. Create an Account </h2>

    <!-- <i class="fi fi-ss-hexagon-check" id="accountTick"></i> -->
    <i class="fi fi-rr-circle" id="down"></i>
</div>
        
        <div class="container" id="accountContainer">
            <div class="social-login">
                <div class="account-link">
                    Already have an account? <a href="#">Log In</a>
                </div>
                <button class="google">
                    <img src="https://img.icons8.com/color/16/000000/google-logo.png" alt="Google logo"/>
                    <b>Google</b>
                </button>
                
                <button class="facebook" onclick="nameActive()">Advance</button>
            </div>
            <div class="separator">
                <span>|</span>
                <span>OR</span>
                <span>|</span>
            </div>
            <div class="login-form">
                <div class="input-group">
                    <input type="email" placeholder="Email Address">
                    <img src="https://img.icons8.com/material-outlined/24/000000/help.png" alt="Help icon"/>
                </div>
                <div class="input-group">
                    <input type="password" placeholder="Password">
                    <img src="https://img.icons8.com/ios-glyphs/24/000000/visible.png" alt="Show password icon"/>
                </div>
            </div>

        </div>
    </div>
<div class="full" id='full-Name'>
<div class="headerrow" id="SenderName">
        <h2>2. Your Sender Name</h2>
        <i class="fi fi-rr-angle-small-down" id="down"></i>
        <!-- <i class="fi fi-rr-angle-small-left" id="down"></i> -->
</div>

<div class="login-form-name" id="InputNameBox">
    <div class="input-group">
        <input type="email" placeholder="Sender Name" id="name" required>
        <img src="https://img.icons8.com/material-outlined/24/000000/help.png" alt="Help icon"/>
    </div>
    <div class="input-group">
        <button class="facebook" onclick="Checkout()">Advance</button>
    </div>
</div>


</div>
<div class="full" id="Checkout-full">
<div class="headerrow" id="PaymentIcon">
    <h2>3. Select Payment</h2>
    <i class="fi fi-rr-angle-small-down" id="down"></i>
    <!-- <i class="fi fi-rr-angle-small-left" id="down"></i> -->
</div>
</div>


    </div>
    <div id="checkout">
        <!-- Checkout will insert the payment form here -->
      </div>

      <script>




        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById('above-checkout').style.display = "none"
                document.getElementById('checkout').style.display = "none"
                document.getElementById('loading').style.display = "flex"
                    // initialize();
        
                });
        
                
        
        function Checkout(){
            const AccountIcon = document.getElementById('Account')
        const SenderNameIcon = document.getElementById('SenderName')
        const CheckoutIcon = document.getElementById('PaymentIcon')
        
            let name = document.getElementById('name').value;
            if (name) {
        
            
            AccountIcon.innerHTML = `
        
        <h2>1. Create an Account </h2>
        
        
        <i class="fi fi-ss-hexagon-check" id="down"></i>
        
        `;
        SenderNameIcon.innerHTML = `
        
                <h2>2. Your Sender Name</h2>
        
               
                <i class="fi fi-ss-hexagon-check" id="down"></i>
        
        
        `;
        CheckoutIcon.innerHTML = `
        
                <h2>3. Select Payment</h2>
        
                 <i class="fi fi-rr-circle" id="down"></i>
        
        `;
        document.getElementById('accountContainer').style.display = "none";
        document.getElementById('InputNameBox').style.display = "none";
        document.getElementById('Checkout-full').style.border = "none";
        document.getElementById('full-Name').style.border = "2px solid black";
        
            const params = new URLSearchParams(window.location.search);
            const plan = decodeURIComponent(params.get('plan') || '');
            let email = decodeURIComponent(params.get('email') || '');
            let password = decodeURIComponent(params.get('password') || '');
                // const token = decodeURIComponent(params.get('token') || ''); // Add this line to get the token from the URL
                if (plan === "f") {  
                    FreeEmail(email, password, name);
                    // if (password == null) {
                        
                    //     FreeToken(email, name);
                    //     console.log(" no pwrd, f")
                    // } else {
                    //     FreeEmail(email, password, name);
                    //     console.log(" email, f", email)
                        
                    // }
        
                } else {
                    PremiumEmail(email, password, name);
                    // if (password == null) {
                    //     PremiumToken(email, name);
                    //     console.log(" no email, p")
                    // } else {
                    //     PremiumEmail(email, password, name);
                    //     console.log(" email, p")
                    // }
                }
        
            }
            else {
                alert("must input a senders name")
            }
        }
        
        async function addCustomer(PriceID){
        
            const params = new URLSearchParams(window.location.search);
            let email = params.get('email');
            let password = decodeURIComponent(params.get('password'));
            let name =  params.get('name');
            let sessionId = params.get('session_id')
            const affiliate = localStorage.getItem('affiliate');
            // let plan = params.get('plan')
        try {
                // Fetch session details from your backend using the session ID
            const sessionResponse = await fetch(`https://volt-server.onrender.com/get-session-details?session_id=${sessionId}`);
                        const sessionData = await sessionResponse.json();
        
                        // Determine plan and total_emails based on price ID
                        let plan, plan_emails;
                        if (PriceID === 'price_1PKf2PKJeZAyw8f418JphiK0') {
                            plan = 'premium';
                            plan_emails = 1000;
                        } else {
                            plan = 'free';
                            plan_emails = 20;
                        }
        
                        const customerData = {
                            stripeID: sessionData.customer.id,
                            email: email,
                            plan: plan,
                            total_emails: 0,
                            priceID: PriceID,
                            password: password,
                            name: name,
                            plan_emails: plan_emails,
                            affiliate: affiliate
                        };
                        console.log(customerData)
                        // Send customer data to your backend to add to the database
                        const addCustomerResponse = await fetch('https://volt-server.onrender.com/add-customer-to-db', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(customerData)
                        });
        
                        const addCustomerResult = await addCustomerResponse.json();
                        console.log(addCustomerResult)
                        // Redirect to dashboard with token
                        if (addCustomerResult.redirectUrl) {
                            window.location.href = addCustomerResult.redirectUrl;
                        }
        
                        // Optionally, show success message or redirect to another page
                        document.getElementById('accountTick').style.display = "block";
                    } catch (error) {
                        console.error('Error handling checkout session:', error);
                    }
        
        }
        
        
        async function initialize() {
            
            const planElement = document.getElementById('selected-plan');
            const params = new URLSearchParams(window.location.search);
            const loggedin = decodeURIComponent(params.get('loggedin') || '');
            const plan = decodeURIComponent(params.get('plan') || '');
            const session = params.get('session_id')
            if (session){
        
        // handle the html 
        
                document.getElementById('above-checkout').style.display = "none"
                document.getElementById('checkout').style.display = "none"
                document.getElementById('loading').style.display = "flex"
                const response = await fetch(`https://volt-server.onrender.com/session-status?session_id=${session}`);
                    const sessionData = await response.json();
                    const success = document.getElementById('success')
                    if (sessionData.status === 'complete') {
                        document.getElementById('processing').classList.remove('active');
                        document.getElementById('processing').classList.add('hidden');
                        document.getElementById('success').classList.remove('hidden');
                        document.getElementById('success').classList.add('active');
                        addCustomer(sessionData.first_price_id)
                    }
                else{
                        document.getElementById('processing').classList.remove('active');
                        document.getElementById('processing').classList.add('hidden');
                        document.getElementById('failure').classList.remove('hidden');
                        document.getElementById('failure').classList.add('active');
        
        
                }
            }
            else{
        
            if (plan === "f") { 
                    planElement.innerHTML = `Selected Plan:  <b>Starter</b>`;
                }
                else{
                    planElement.innerHTML = `Selected Plan:  <b>Premium</b>`;
                }
        
            if (loggedin === "true") {
                nameActive()
            } else {
                singupActive()
            }
        
            }
        }
        
        function failedCheckout(){
            const params = new URLSearchParams(window.location.search);
            let email = decodeURIComponent(params.get('email') || '');
            let password = decodeURIComponent(params.get('password') || '');
        
            let url = `https://syneticslz.github.io/test-client/payment.html?loggedin=true&plan=f`;
            url += `&email=${encodeURIComponent(email)}`;
            url += `&password=${encodeURIComponent(password)}`;
            window.location.href = url;
        }
        
         function singupActive(){
            const AccountIcon = document.getElementById('Account')
        const SenderNameIcon = document.getElementById('SenderName')
        const CheckoutIcon = document.getElementById('PaymentIcon')
        AccountIcon.innerHTML = `
        
        <h2>1. Create an Account </h2>
        
        <i class="fi fi-rr-circle" id="down"></i>
        
        `;
        SenderNameIcon.innerHTML = `
        
                <h2>2. Your Sender Name</h2>
        
                <i class="fi fi-rr-angle-small-down" id="down"></i>
        
        `;
        CheckoutIcon.innerHTML = `
        
                <h2>3. Select Payment</h2>
        
                <i class="fi fi-rr-angle-small-down" id="down"></i>
        
        `;
        
            document.getElementById('accountContainer').style.display = "flex";
            document.getElementById('InputNameBox').style.display = "none";
            document.getElementById('full-Account').style.border = "none";
            document.getElementById('full-Name').style.border = "2px solid black";
        }
        
        
        
        
        function nameActive(){
        const AccountIcon = document.getElementById('Account')
        const SenderNameIcon = document.getElementById('SenderName')
        const CheckoutIcon = document.getElementById('PaymentIcon')
            
        AccountIcon.innerHTML = `
        
        <h2>1. Create an Account </h2>
        
        
        <i class="fi fi-ss-hexagon-check" id="down"></i>
        
        `;
        SenderNameIcon.innerHTML = `
        
                <h2>2. Your Sender Name</h2>
        
                <i class="fi fi-rr-circle" id="down"></i>
        
        `;
        CheckoutIcon.innerHTML = `
        
                <h2>3. Select Payment</h2>
        
                <i class="fi fi-rr-angle-small-down" id="down"></i>
        
        `;
            document.getElementById('accountContainer').style.display = "none";
            document.getElementById('InputNameBox').style.display = "flex";
            document.getElementById('full-Account').style.border = "2px solid black";
            document.getElementById('full-Name').style.border = "none";
        }
        
        function parseJWT(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            
            return JSON.parse(jsonPayload);
        }
        
        
        // Create a Checkout Session
        async function PremiumEmail(emailx, password, name) {
            console.log("running premium email")
                    const stripe = Stripe('pk_test_51MNx4UKJeZAyw8f4z0YJFRQozQsqzwCBKOuzaSScWRXgDDG8GW9YH3qyrI9UZlUW1V8RXkieoHgqoaMOtIbxlLSm00QDD02K7W');
                    const fetchClientSecret = async (email) => {
                        const response = await fetch('https://volt-server.onrender.com/create-checkout-session', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ email: emailx, password: password, name: name })  // Pass the email in the request body
                        });
                        const data = await response.json();
                        if (data.error) {
                            console.error('Error:', data.error);
                            throw new Error(data.error);
                        }
                        return data.clientSecret;
                    };
                    try {
                        const checkout = await stripe.initEmbeddedCheckout({
                            clientSecret: await fetchClientSecret(),
                        });
                        checkout.mount('#checkout');
                    } catch (e) {
                        console.error('Error initializing embedded checkout:', e);
                    }
        };
        
        // async function PremiumToken(email) {
        //     console.log("running premium email with token")
        //             const stripe = Stripe('pk_test_51MNx4UKJeZAyw8f4z0YJFRQozQsqzwCBKOuzaSScWRXgDDG8GW9YH3qyrI9UZlUW1V8RXkieoHgqoaMOtIbxlLSm00QDD02K7W');
        //             const userData = parseJWT(token);
        //             const fetchClientSecret = async (email) => {
        //                 const response = await fetch('https://volt-server.onrender.com/create-checkout-session-token', {
        //                     method: 'POST',
        //                     headers: {
        //                         'Content-Type': 'application/json',
        //                     },
        //                     body: JSON.stringify({ email:email })  // Pass the email in the request body
        //                 });
        //                 const data = await response.json();
        //                 if (data.error) {
        //                     console.error('Error:', data.error);
        //                     throw new Error(data.error);
        //                 }
        //                 return data.clientSecret;
        //             };
        //             try {
        //                 const checkout = await stripe.initEmbeddedCheckout({
        //                     clientSecret: await fetchClientSecret(),
        //                 });
        //                 checkout.mount('#checkout');
        //             } catch (e) {
        //                 console.error('Error initializing embedded checkout:', e);
        //             }
        // };
        
        
        async function FreeEmail(emailx, password, name) {
            console.log("running free email")
                    const stripe = Stripe('pk_test_51MNx4UKJeZAyw8f4z0YJFRQozQsqzwCBKOuzaSScWRXgDDG8GW9YH3qyrI9UZlUW1V8RXkieoHgqoaMOtIbxlLSm00QDD02K7W');
                    const fetchClientSecret = async (email) => {
                        const response = await fetch('https://volt-server.onrender.com/create-checkout-session-free', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ email: emailx, password: password, name: name })  // Pass the email in the request body
                        });
                        const data = await response.json();
                        if (data.error) {
                            console.error('Error:', data.error);
                            throw new Error(data.error);
                        }
                        return data.clientSecret;
                    };
                    try {
                        const checkout = await stripe.initEmbeddedCheckout({
                            clientSecret: await fetchClientSecret(),
                        });
                        checkout.mount('#checkout');
                    } catch (e) {
                        console.error('Error initializing embedded checkout:', e);
                    }
        };
        
        // async function FreeToken(email) {
        //     console.log("running free token email")
        //             const stripe = Stripe('pk_test_51MNx4UKJeZAyw8f4z0YJFRQozQsqzwCBKOuzaSScWRXgDDG8GW9YH3qyrI9UZlUW1V8RXkieoHgqoaMOtIbxlLSm00QDD02K7W');
        //             const userData = parseJWT(token);
        //             const fetchClientSecret = async (email) => {
        //                 const response = await fetch('https://volt-server.onrender.com/create-checkout-session-free-token', {
        //                     method: 'POST',
        //                     headers: {
        //                         'Content-Type': 'application/json',
        //                     },
        //                     body: JSON.stringify({ email: email })  // Pass the email in the request body
        //                 });
        //                 const data = await response.json();
        //                 if (data.error) {
        //                     console.error('Error:', data.error);
        //                     throw new Error(data.error);
        //                 }
        //                 return data.clientSecret;
        //             };
        //             try {
        //                 const checkout = await stripe.initEmbeddedCheckout({
        //                     clientSecret: await fetchClientSecret(),
        //                 });
        //                 checkout.mount('#checkout');
        //             } catch (e) {
        //                 console.error('Error initializing embedded checkout:', e);
        //             }
        // };
        
            </script>
            
</body>
</html>
